var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e])};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Player=function(){function n(){}return n.create=function(n){switch(n.charAt(0)){case"w":return new Red;case"g":return new Blue;case"b":return new Yellow;case"r":return new Green;case"d":return new Dead;default:return}},n}(),Red=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Red",t.turn=1,t}return __extends(t,n),t.prototype.transform=function(n,t){return[n,t]},t}(Player),Blue=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Blue",t.turn=2,t}return __extends(t,n),t.prototype.transform=function(n,t){return[-t,n]},t}(Player),Yellow=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Yellow",t.turn=3,t}return __extends(t,n),t.prototype.transform=function(n,t){return[-n,-t]},t}(Player),Green=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Green",t.turn=4,t}return __extends(t,n),t.prototype.transform=function(n,t){return[t,-n]},t}(Player),Dead=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Dead",t.turn=0,t}return __extends(t,n),t.prototype.transform=function(n,t){throw new Error("Not implemented")},t}(Player),Vector=function(){return function(n,t){this.dx=n,this.dy=t}}(),Radius=function(){function n(n){this.counter=0,this.max=n}return n.prototype.next=function(){return!this.max||this.max&&this.max>=++this.counter?{value:this.counter,done:!1}:{value:null,done:!0}},n}(),Piece=function(){function n(n){this.player=Player.create(n),this.dp=n}return n.create=function(n){switch(n.charAt(1)){case"R":return new Rook(n);case"P":return new Pawn(n);case"K":return new King(n);case"Q":return new Queen(n);case"B":return new Bishop(n);case"N":return new Knight(n);default:return}},n}(),Rook=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Rook",e.jump=!1,e.radius=new Radius,e.attack=[new Vector(function(n,t){return n+t},function(n){return n}),new Vector(function(n,t){return n-t},function(n){return n}),new Vector(function(n){return n},function(n,t){return n+t}),new Vector(function(n){return n},function(n,t){return n-t})],e.mobility=[new Vector(function(n,t){return n+t},function(n){return n}),new Vector(function(n,t){return n-t},function(n){return n}),new Vector(function(n){return n},function(n,t){return n+t}),new Vector(function(n){return n},function(n,t){return n-t})],e}return __extends(t,n),t}(Piece),Pawn=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Pawn",e.jump=!1,e.radius=new Radius(2),e.attack=[new Vector(function(n){return n+1},function(n){return n+1}),new Vector(function(n){return n-1},function(n){return n+1})],e.mobility=[new Vector(function(n){return n},function(n,t){return n+t})],e}return __extends(t,n),t}(Piece),King=function(n){function t(t){var e=n.call(this,t)||this;return e.name="King",e.jump=!1,e.radius=new Radius(1),e.attack=[new Vector(function(n){return n+1},function(n){return n}),new Vector(function(n){return n-1},function(n){return n}),new Vector(function(n){return n},function(n){return n+1}),new Vector(function(n){return n},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+1}),new Vector(function(n){return n+1},function(n){return n-1}),new Vector(function(n){return n-1},function(n){return n+1}),new Vector(function(n){return n-1},function(n){return n-1})],e.mobility=[new Vector(function(n){return n+1},function(n){return n}),new Vector(function(n){return n-1},function(n){return n}),new Vector(function(n){return n},function(n){return n+1}),new Vector(function(n){return n},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+1}),new Vector(function(n){return n+1},function(n){return n-1}),new Vector(function(n){return n-1},function(n){return n+1}),new Vector(function(n){return n-1},function(n){return n-1})],e}return __extends(t,n),t}(Piece),Queen=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Queen",e.jump=!1,e.radius=new Radius,e.attack=[new Vector(function(n,t){return n+t},function(n){return n}),new Vector(function(n,t){return n-t},function(n){return n}),new Vector(function(n){return n},function(n,t){return n+t}),new Vector(function(n){return n},function(n,t){return n-t}),new Vector(function(n,t){return n+t},function(n,t){return n+t}),new Vector(function(n,t){return n+t},function(n,t){return n-t}),new Vector(function(n,t){return n-t},function(n,t){return n+t}),new Vector(function(n,t){return n-t},function(n,t){return n-t})],e.mobility=[new Vector(function(n,t){return n+t},function(n){return n}),new Vector(function(n,t){return n-t},function(n){return n}),new Vector(function(n){return n},function(n,t){return n+t}),new Vector(function(n){return n},function(n,t){return n-t}),new Vector(function(n,t){return n+t},function(n,t){return n+t}),new Vector(function(n,t){return n+t},function(n,t){return n-t}),new Vector(function(n,t){return n-t},function(n,t){return n+t}),new Vector(function(n,t){return n-t},function(n,t){return n-t})],e}return __extends(t,n),t}(Piece),Bishop=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Bishop",e.jump=!1,e.radius=new Radius,e.attack=[new Vector(function(n,t){return n+t},function(n,t){return n+t}),new Vector(function(n,t){return n+t},function(n,t){return n-t}),new Vector(function(n,t){return n-t},function(n,t){return n+t}),new Vector(function(n,t){return n-t},function(n,t){return n-t})],e.mobility=[new Vector(function(n,t){return n+t},function(n,t){return n+t}),new Vector(function(n,t){return n+t},function(n,t){return n-t}),new Vector(function(n,t){return n-t},function(n,t){return n+t}),new Vector(function(n,t){return n-t},function(n,t){return n-t})],e}return __extends(t,n),t}(Piece),Knight=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Knight",e.jump=!0,e.radius=new Radius(1),e.attack=[new Vector(function(n){return n+2},function(n){return n+1}),new Vector(function(n){return n+2},function(n){return n-1}),new Vector(function(n){return n-2},function(n){return n+1}),new Vector(function(n){return n-2},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+2}),new Vector(function(n){return n+1},function(n){return n-2}),new Vector(function(n){return n-1},function(n){return n+2}),new Vector(function(n){return n-1},function(n){return n-2})],e.mobility=[new Vector(function(n){return n+2},function(n){return n+1}),new Vector(function(n){return n+2},function(n){return n-1}),new Vector(function(n){return n-2},function(n){return n+1}),new Vector(function(n){return n-2},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+2}),new Vector(function(n){return n+1},function(n){return n-2}),new Vector(function(n){return n-1},function(n){return n+2}),new Vector(function(n){return n-1},function(n){return n-2})],e}return __extends(t,n),t}(Piece),Square=function(){function n(n,t){return this.m=n,this.n=t,this}return n.coords=function(n){return[parseInt(n.slice(1))-1,n.charCodeAt(0)-97]},n.prototype.char=function(n){return String.fromCharCode(n+97)},n.prototype.code=function(){return""+this.char(this.n)+(this.m+1)},n.prototype.accessible=function(){return this.m>=4&&this.m<=11&&this.n>=1&&this.n<=3||this.m>=1&&this.m<=14&&this.n>=4&&this.n<=11||this.m>=4&&this.m<=11&&this.n>=12&&this.n<=14},n}(),DiffSquare=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),t}(Square),AnalysisSquare=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.candidates=[],t}return __extends(t,n),t}(Square),Board=function(){function n(){this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var t=0;t<14;t++)this.squares[n][t]=new Square(n,t)}}return n.prototype.square=function(n){var t=Square.coords(n);return this.squares[t[0]][t[1]]},n}(),Diff=function(){function n(){this.deaths=[],this.captures=[],this.removals=[],this.additions=[],this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var t=0;t<14;t++)this.squares[n][t]=new DiffSquare(n,t)}}return n.prototype.square=function(n){var t=DiffSquare.coords(n);return this.squares[t[0]][t[1]]},n}(),Analysis=function(){function n(){this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var t=0;t<14;t++)this.squares[n][t]=new AnalysisSquare(n,t)}}return n.prototype.square=function(n){var t=AnalysisSquare.coords(n);return this.squares[t[0]][t[1]]},n}(),Turn=function(){return function(n){this.diff=new Diff,this.added=new Board,this.removed=new Board,this.analysis=new Analysis,this.index=n}}(),Factory=function(){function n(){this.turns=[]}return n.prototype.piece=function(n){for(var t=0;t<n.length;t++){var e=n[t];if(e instanceof HTMLElement&&0===e.className.indexOf("piece-"))return e}},n.prototype.createBoards=function(n,t){var e=t.removedNodes,r=t.addedNodes;if(r.length>=14&&e.length>=14)for(var u=0;u<14;u++)for(var o=0;o<14;o++){var i=r[u].childNodes[o],c=e[u].childNodes[o];if(i instanceof HTMLElement&&c instanceof HTMLElement){var s=this.piece(i.childNodes),a=this.piece(c.childNodes);if(s){var f=s.attributes["data-piece"],d=i.attributes["data-square"];if(f&&d){var h=Piece.create(f.value);n.added.square(d.value).piece=h}}if(a){f=a.attributes["data-piece"],d=c.attributes["data-square"];if(f&&d){h=Piece.create(f.value);n.removed.square(d.value).piece=h}}}}},n.prototype.createDiffBoard=function(n){for(var t=0;t<14;t++)for(var e=0;e<14;e++){var r=n.removed.squares[t][e],u=n.added.squares[t][e],o=n.diff.squares[t][e];!r.piece&&u.piece&&(n.diff.additions.push(u),o.piece=u.piece,o.change="+"),r.piece&&!u.piece&&(n.diff.removals.push(r),o.piece=r.piece,o.change="-"),r.piece&&u.piece&&r.piece.dp!==u.piece.dp&&(o.piece=u.piece,u.piece.player instanceof Dead?(n.diff.deaths.push(u),o.change="x"):(n.diff.captures.push(u),o.change="*"))}},n.prototype.process=function(n){for(var t=0,e=0,r=n;e<r.length;e++){var u=r[e];if("childList"===u.type&&u.target instanceof HTMLElement&&0===u.target.className.indexOf("board-")){var o=new Turn(++t);this.createBoards(o,u),this.createDiffBoard(o),this.turns.push(o)}}return this},n.prototype.analyse=function(){for(var n=1;n<this.turns.length;n++){console.group("turn:%i",n);for(var t=new Analysis,e=this.turns[n],r=e.added,u=0;u<14;u++){console.group("m:%i",u);for(var o=0;o<14;o++){console.group("n:%i",o);var i=r.squares[u][o].piece;if(i){console.group("piece:%O",i);var c=i.player.transform(o,u),s=c[0],a=c[1];console.log("x:%i,y:%i",s,a);for(var f=0,d=i.mobility;f<d.length;f++)for(var h=d[f],p=!1,l=i.radius.next();!l.done&&!p;){var w=l.value,v=h.dy(a,w),V=h.dx(s,w),y=r.squares[v][V];if(console.log("radius:%i, dx:%i, dy:%i, target:%O",w,V,v,y),l=i.radius.next(),y.accessible()){var m=y.code(),g=t.square(m);if(console.log("code:%s, goal:%O",m,g),g.candidates.push(i),!y.piece)continue;p=!0}}console.groupEnd()}console.groupEnd()}console.groupEnd()}e.analysis=t,console.groupEnd()}return this},n.prototype.header=function(n){return"Index: "+n.index+"; Additions: "+n.diff.additions.length+"; Removals: "+n.diff.removals.length+"; Captures: "+n.diff.captures.length+"; Deaths: "+n.diff.deaths.length},n.prototype.show=function(n){for(var t=1;t<Math.min(this.turns.length,n);t++){var e=this.turns[t];console.group(this.header(e));for(var r=0;r<14;r++){for(var u=["|"],o=0;o<14;o++){var i=e.added.squares[r][o];u.push(i.piece?i.piece.dp:"[]")}u.push("|");for(o=0;o<14;o++){i=e.diff.squares[r][o];u.push(i.piece?i.piece.dp+i.change:"[ ]")}u.push("|");var c=e.analysis.squares;console.log(u.join(" ")+"%O %O %O %O %O %O %O %O %O %O %O %O %O %O |",c[r][0],c[r][1],c[r][2],c[r][3],c[r][4],c[r][5],c[r][6],c[r][7],c[r][8],c[r][9],c[r][10],c[r][11],c[r][12],c[r][13])}console.groupEnd()}return this},n}();