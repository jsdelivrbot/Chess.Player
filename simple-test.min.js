var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])};return function(t,r){function e(){this.constructor=t}n(t,r),t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}}(),Player=function(){function n(){}return n.create=function(n){switch(n.charAt(0)){case"w":return new Red;case"g":return new Blue;case"b":return new Yellow;case"r":return new Green;case"d":return new Dead;default:return}},n}(),Red=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Red",t.turn=1,t}return __extends(t,n),t.prototype.transform=function(n,t,r,e){return[n+r,t+e]},t}(Player),Blue=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Blue",t.turn=2,t}return __extends(t,n),t.prototype.transform=function(n,t,r,e){return[n+e,t-r]},t}(Player),Yellow=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Yellow",t.turn=3,t}return __extends(t,n),t.prototype.transform=function(n,t,r,e){return[n-r,t-e]},t}(Player),Green=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Green",t.turn=4,t}return __extends(t,n),t.prototype.transform=function(n,t,r,e){return[n-e,t+r]},t}(Player),Dead=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Dead",t.turn=0,t}return __extends(t,n),t.prototype.transform=function(n,t){throw new Error("Not implemented")},t}(Player),Vector=function(){return function(n,t){this.x1=n,this.y1=t}}(),Radius=function(){function n(n){this.counter=0,this.max=n}return n.prototype.next=function(){return!this.max||this.counter<this.max?(this.counter++,{value:this.counter,done:!1}):(this.counter=0,{value:void 0,done:!0})},n.prototype.reset=function(){this.counter=0},n}(),Piece=function(){function n(n,t){this.coords=Square.coords(t),this.player=Player.create(n),this.dp=n}return n.prototype.moved=function(){for(var n=!0,t=0;t<this.home.length;t++){var r=this.home[t][0]-6.5,e=this.home[t][1]-6.5,o=this.player.transform(6.5,6.5,e,r),u=o[0],i=o[1];if(this.coords[1]===u&&this.coords[0]===i){n=!1;break}}return n},n.create=function(n,t){switch(n.charAt(1)){case"R":return new Rook(n,t);case"P":return new Pawn(n,t);case"K":return new King(n,t);case"Q":return new Queen(n,t);case"B":return new Bishop(n,t);case"N":return new Knight(n,t);default:return}},n}(),Rook=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Rook",t.radius=new Radius,t.home=[[0,3],[0,10]],t}return __extends(t,n),t.prototype.attack=function(){return[]},t.prototype.mobility=function(){return[[new Vector(function(n){return n},function(n){return 0}),!0],[new Vector(function(n){return-n},function(n){return 0}),!0],[new Vector(function(n){return 0},function(n){return n}),!0],[new Vector(function(n){return 0},function(n){return-n}),!0]]},t}(Piece),Pawn=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Pawn",t.radius=new Radius(1),t.home=[[1,3],[1,4],[1,5],[1,6],[1,7],[1,8],[1,9],[1,10]],t}return __extends(t,n),t.prototype.attack=function(){return[[new Vector(function(n){return 1},function(n){return 1}),!0],[new Vector(function(n){return-1},function(n){return 1}),!0]]},t.prototype.mobility=function(){return this.moved()?[[new Vector(function(n){return 0},function(n){return 1}),!0]]:[[new Vector(function(n){return 0},function(n){return 1}),!0],[new Vector(function(n){return 0},function(n){return 2}),!0]]},t}(Piece),King=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="King",t.radius=new Radius(1),t.home=t.player instanceof Red||t.player instanceof Yellow?[[0,7]]:[[0,6]],t}return __extends(t,n),t.prototype.attack=function(){return[]},t.prototype.mobility=function(){return[[new Vector(function(n){return 1},function(n){return 0}),!0],[new Vector(function(n){return-1},function(n){return 0}),!0],[new Vector(function(n){return 0},function(n){return 1}),!0],[new Vector(function(n){return 0},function(n){return-1}),!0],[new Vector(function(n){return 1},function(n){return 1}),!0],[new Vector(function(n){return 1},function(n){return-1}),!0],[new Vector(function(n){return-1},function(n){return 1}),!0],[new Vector(function(n){return-1},function(n){return-1}),!0]]},t}(Piece),Queen=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Queen",t.radius=new Radius,t.home=t.player instanceof Red||t.player instanceof Yellow?[[0,6]]:[[0,7]],t}return __extends(t,n),t.prototype.attack=function(){return[]},t.prototype.mobility=function(){return[[new Vector(function(n){return n},function(n){return 0}),!0],[new Vector(function(n){return-n},function(n){return 0}),!0],[new Vector(function(n){return 0},function(n){return n}),!0],[new Vector(function(n){return 0},function(n){return-n}),!0],[new Vector(function(n){return n},function(n){return n}),!0],[new Vector(function(n){return n},function(n){return-n}),!0],[new Vector(function(n){return-n},function(n){return n}),!0],[new Vector(function(n){return-n},function(n){return-n}),!0]]},t}(Piece),Bishop=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Bishop",t.radius=new Radius,t.home=[[0,5],[0,8]],t}return __extends(t,n),t.prototype.attack=function(){return[]},t.prototype.mobility=function(){return[[new Vector(function(n){return n},function(n){return n}),!0],[new Vector(function(n){return n},function(n){return-n}),!0],[new Vector(function(n){return-n},function(n){return n}),!0],[new Vector(function(n){return-n},function(n){return-n}),!0]]},t}(Piece),Knight=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Knight",t.radius=new Radius(1),t.home=[[0,4],[0,9]],t}return __extends(t,n),t.prototype.attack=function(){return[]},t.prototype.mobility=function(){return[[new Vector(function(n){return 2},function(n){return 1}),!0],[new Vector(function(n){return 2},function(n){return-1}),!0],[new Vector(function(n){return-2},function(n){return 1}),!0],[new Vector(function(n){return-2},function(n){return-1}),!0],[new Vector(function(n){return 1},function(n){return 2}),!0],[new Vector(function(n){return 1},function(n){return-2}),!0],[new Vector(function(n){return-1},function(n){return 2}),!0],[new Vector(function(n){return-1},function(n){return-2}),!0]]},t}(Piece),Square=function(){function n(n,t){return this.candidates=[],this.m=n,this.n=t,this}return n.coords=function(n){return[parseInt(n.slice(1))-1,n.charCodeAt(0)-97]},n.prototype.char=function(n){return String.fromCharCode(n+97)},n.prototype.code=function(){return""+this.char(this.n)+(this.m+1)},n.prototype.accessible=function(){return this.m>=3&&this.m<=10&&this.n>=0&&this.n<=2||this.m>=0&&this.m<=13&&this.n>=3&&this.n<=10||this.m>=3&&this.m<=10&&this.n>=11&&this.n<=13},n}(),Board=function(){function n(){this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var t=0;t<14;t++)this.squares[n][t]=new Square(n,t)}}return n.prototype.square=function(n){var t=Square.coords(n);return this.squares[t[0]][t[1]]},n.prototype.valid=function(n,t){return n>=0&&n<=13&&t>=0&&t<=13},n}(),Turn=function(){return function(n){this.board=new Board,this.index=n}}(),Factory=function(){function n(){this.turns=[]}return n.prototype.piece=function(n){for(var t=0;t<n.length;t++){var r=n[t];if(r instanceof HTMLElement&&0===r.className.indexOf("piece-"))return r}},n.prototype.create=function(n,t){var r=t.addedNodes;if(r.length>=14)for(var e=0;e<14;e++)for(var o=0;o<14;o++){var u=r[e].childNodes[o];if(u instanceof HTMLElement){var i=this.piece(u.childNodes);if(i){var c=i.attributes["data-piece"],a=u.attributes["data-square"];if(c&&a){var s=Piece.create(c.value,a.value);n.board.square(a.value).piece=s}}}}},n.prototype.process=function(n){for(var t=0,r=0,e=n;r<e.length;r++){var o=e[r];if("childList"===o.type&&o.target instanceof HTMLElement&&0===o.target.className.indexOf("board-")){var u=new Turn(++t);this.create(u,o),this.analyse(u),this.show(u),this.turns.push(u)}}return this},n.prototype.remaining=function(n){for(var t=0,r=0;r<n.length;r++)n[r][1]&&t++;return t},n.prototype.radius=function(n,t,r,e,o,u){for(;;){var i=t.radius.next(),c=this.remaining(r);if(i.done||i.value>14||0===c){t.radius.reset();break}for(var a=0;a<r.length;a++)this.vector(n,t,r[a],e,o,u,i.value)}},n.prototype.vector=function(n,t,r,e,o,u,i){if(r[1]){var c=r[0].x1(i),a=r[0].y1(i),s=t.player.transform(u,o,c,a),f=s[0],p=s[1];n.board.valid(f,p)&&n.board.squares[p][f].accessible()?n.board.squares[p][f].piece?(e&&n.board.squares[p][f].candidates.push(t),r[1]=!1):n.board.squares[p][f].candidates.push(t):r[1]=!1}},n.prototype.analyse=function(n){for(var t=0;t<14;t++)for(var r=0;r<14;r++){var e=n.board.squares[t][r];if(e.accessible()){var o=e.piece;o&&(o.player instanceof Dead||(this.radius(n,o,o.mobility(),!0,t,r),this.radius(n,o,o.attack(),!1,t,r)))}}},n.prototype.show=function(n){console.group("turn:"+n.index);for(var t=0;t<14;t++){for(var r=["|"],e=0;e<14;e++){var o=n.board.squares[t][e];o.accessible()?r.push(o.piece?o.piece.dp:"[]"):r.push("  ")}r.push("|");var u=n.board.squares;console.log(r.join(" ")+"%O %O %O %O %O %O %O %O %O %O %O %O %O %O |",u[t][0],u[t][1],u[t][2],u[t][3],u[t][4],u[t][5],u[t][6],u[t][7],u[t][8],u[t][9],u[t][10],u[t][11],u[t][12],u[t][13])}console.groupEnd()},n}();