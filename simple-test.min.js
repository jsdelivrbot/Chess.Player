var Change,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){e[e.Added=0]="Added",e[e.Removed=1]="Removed",e[e.Captured=2]="Captured",e[e.Died=3]="Died"}(Change||(Change={}));var Player=function(){return function(e){this.map={b:"Yellow",r:"Green",g:"Blue",d:"Dead",w:"Red"},this.name=this.map[e.charAt(0)]}}(),Piece=function(){return function(e){this.map={R:"Rook",P:"Pawn",K:"King",Q:"Queen",B:"Bishop",N:"Knight"},this.name=this.map[e.charAt(1)],this.player=new Player(e),this.dp=e}}(),Square=function(){function e(e,t){this.code=this.convert(e,t),this.m=e,this.n=t}return e.prototype.convert=function(e,t){return""+String.fromCharCode(t+97)+(e+1)},e}(),Board=function(){return function(){this.squares=[];for(var e=0;e<14;e++){this.squares[e]=[];for(var t=0;t<14;t++)this.squares[e][t]=new Square(e,t)}}}(),Turn=function(){return function(e){this.datetime=e,this.board=new Board}}(),Variance=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.additions=0,t.captures=0,t.removals=0,t.deaths=0,t}return __extends(t,e),t}(Turn),Factory=function(){function e(){this.turns=[],this.variances=[],this.corrections=[]}return e.prototype.turn=function(e){for(var t=0,r=this.turns;t<r.length;t++){var n=r[t];if(n.datetime===e)return n}return null},e.prototype.variance=function(e){for(var t=0,r=this.variances;t<r.length;t++){var n=r[t];if(n.datetime===e)return n}return null},e.prototype.map=function(e){switch(e){case Change.Added:return"+";case Change.Removed:return"-";case Change.Captured:return"*";case Change.Died:return"x";default:return" "}},e.prototype.process=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if("childList"===n.mutation.type&&n.mutation.target.attributes["data-square"]){var a=this.turn(n.datetime);null==a&&(a=new Turn(n.datetime),this.turns.push(a));var i=n.mutation.target.attributes["data-square"].value;if(1===n.mutation.addedNodes.length)for(var o=n.mutation.addedNodes[0].attributes["data-piece"].value,s=0;s<14;s++)for(var u=0;u<14;u++)a.board.squares[s][u].code===i&&(a.board.squares[s][u].piece=new Piece(o))}}return this},e.prototype.analyse=function(){if(this.turns.length>1)for(var e=1;e<this.turns.length;e++){for(var t=new Variance(this.turns[e].datetime),r=0;r<14;r++)for(var n=0;n<14;n++){var a=this.turns[e].board.squares[r][n],i=this.turns[e-1].board.squares[r][n];void 0===i.piece&&void 0!==a.piece&&(t.board.squares[r][n].piece=a.piece,t.board.squares[r][n].change=Change.Added,t.additions++),void 0!==i.piece&&void 0===a.piece&&(t.board.squares[r][n].piece=i.piece,t.board.squares[r][n].change=Change.Removed,t.removals++),void 0!==i.piece&&void 0!==a.piece&&i.piece.dp!==a.piece.dp&&(t.board.squares[r][n].piece=a.piece,"Dead"===a.piece.player.name?(t.board.squares[r][n].change=Change.Died,t.deaths++):(t.board.squares[r][n].change=Change.Captured,t.captures++))}this.variances.push(t)}return this},e.prototype.correct=function(){for(var e=0;e<14;e++)for(var t=0;t<14;t++);return this},e.prototype.apply=function(){return this},e.prototype.header=function(e,t){return"When: "+e.datetime+"                         Additions: "+t.additions+"     Removals: "+t.removals+"     Captures: "+t.captures+"     Deaths: "+t.deaths},e.prototype.show=function(e){for(var t=1;t<Math.min(this.turns.length,e);t++){var r=this.turns[t],n=this.variance(r.datetime);console.log(this.header(r,n));for(var a=0;a<14;a++){for(var i="[ ",o=0;o<14;o++){void 0===(s=r.board.squares[a][o]).piece?i+="[]":i+=s.piece.dp,i+=" "}i+="]  |  [ ";for(o=0;o<14;o++){var s;void 0===(s=n.board.squares[a][o]).piece?i+="[ ]":(i+=s.piece.dp,i+=this.map(s.change)),i+=" "}i+="]",console.log(i)}console.log("")}return this},e}();