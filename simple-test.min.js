var Change;!function(e){e[e.Added=0]="Added",e[e.Removed=1]="Removed",e[e.Captured=2]="Captured",e[e.Died=3]="Died"}(Change||(Change={}));var Player=function(){return function(e){this.map={b:"Yellow",r:"Green",g:"Blue",d:"Dead",w:"Red"},this.name=this.map[e.charAt(0)]}}(),Piece=function(){return function(e){this.map={R:"Rook",P:"Pawn",K:"King",Q:"Queen",B:"Bishop",N:"Knight"},this.name=this.map[e.charAt(1)],this.player=new Player(e),this.dp=e}}(),Square=function(){function e(e,t){this.code=this.convert(e,t),this.m=e,this.n=t}return e.prototype.convert=function(e,t){return""+String.fromCharCode(t+97)+(e+1)},e}(),Board=function(){return function(){this.squares=[];for(var e=0;e<14;e++){this.squares[e]=[];for(var t=0;t<14;t++)this.squares[e][t]=new Square(e,t)}}}(),Turn=function(){return function(e){this.datetime=e,this.board=new Board}}(),Factory=function(){function e(){this.turns=[],this.changes=[]}return e.prototype.turn=function(e){for(var t=0,r=this.turns;t<r.length;t++){var a=r[t];if(a.datetime===e)return a}return null},e.prototype.change=function(e){for(var t=0,r=this.changes;t<r.length;t++){var a=r[t];if(a.datetime===e)return a}return null},e.prototype.map=function(e){switch(e){case Change.Added:return"+";case Change.Removed:return"-";case Change.Captured:return"*";case Change.Died:return"x";default:return" "}},e.prototype.process=function(e){for(var t=0,r=e;t<r.length;t++){var a=r[t];if("childList"===a.mutation.type&&a.mutation.target.attributes["data-square"]){var n=this.turn(a.datetime);null==n&&(n=new Turn(a.datetime),this.turns.push(n));var i=a.mutation.target.attributes["data-square"].value;if(1===a.mutation.addedNodes.length)for(var o=a.mutation.addedNodes[0].attributes["data-piece"].value,s=0;s<14;s++)for(var u=0;u<14;u++)n.board.squares[s][u].code===i&&(n.board.squares[s][u].piece=new Piece(o))}}return this},e.prototype.analyse=function(){if(this.turns.length>1)for(var e=1;e<this.turns.length;e++){for(var t=new Turn(this.turns[e].datetime),r=0;r<14;r++)for(var a=0;a<14;a++){var n=this.turns[e].board.squares[r][a],i=this.turns[e-1].board.squares[r][a];void 0===i.piece&&void 0!==n.piece&&(t.board.squares[r][a].piece=n.piece,t.board.squares[r][a].change=Change.Added),void 0!==i.piece&&void 0===n.piece&&(t.board.squares[r][a].piece=i.piece,t.board.squares[r][a].change=Change.Removed),void 0!==i.piece&&void 0!==n.piece&&i.piece.dp!==n.piece.dp&&(t.board.squares[r][a].piece=n.piece,"Dead"===n.piece.player.name?t.board.squares[r][a].change=Change.Died:t.board.squares[r][a].change=Change.Captured)}this.changes.push(t)}return this},e.prototype.show=function(e){for(var t=1;t<Math.min(this.turns.length,e);t++){var r=this.turns[t];console.log("When: "+r.datetime);for(var a=0;a<14;a++){for(var n="[ ",i=0;i<14;i++){void 0===(s=r.board.squares[a][i]).piece?n+="[]":n+=s.piece.dp,n+=" "}n+="]  |  [ ";var o=this.change(r.datetime);for(i=0;i<14;i++){var s;void 0===(s=o.board.squares[a][i]).piece?n+="[ ]":(n+=s.piece.dp,n+=this.map(s.change)),n+=" "}n+="]",console.log(n)}console.log("")}return this},e}();