var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e])};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Player=function(){function n(){}return n.create=function(n){switch(n.charAt(0)){case"w":return new Red;case"g":return new Blue;case"b":return new Yellow;case"r":return new Green;case"d":return new Dead;default:return}},n}(),Red=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Red",t.turn=1,t}return __extends(t,n),t.prototype.transform=function(n,t,e,r){return[n+e,t+r]},t}(Player),Blue=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Blue",t.turn=2,t}return __extends(t,n),t.prototype.transform=function(n,t,e,r){return[n+r,t-e]},t}(Player),Yellow=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Yellow",t.turn=3,t}return __extends(t,n),t.prototype.transform=function(n,t,e,r){return[n-e,t-r]},t}(Player),Green=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Green",t.turn=4,t}return __extends(t,n),t.prototype.transform=function(n,t,e,r){return[n-r,t+e]},t}(Player),Dead=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.name="Dead",t.turn=0,t}return __extends(t,n),t.prototype.transform=function(n,t){throw new Error("Not implemented")},t}(Player),Vector=function(){return function(n,t){this.x1=n,this.y1=t}}(),Radius=function(){function n(n){this.counter=0,this.max=n}return n.prototype.next=function(){return!this.max||this.counter<this.max?(this.counter++,{value:this.counter,done:!1}):(this.counter=0,{value:void 0,done:!0})},n.prototype.reset=function(){this.counter=0},n}(),Piece=function(){function n(n){this.player=Player.create(n),this.dp=n}return n.create=function(n){switch(n.charAt(1)){case"R":return new Rook(n);case"P":return new Pawn(n);case"K":return new King(n);case"Q":return new Queen(n);case"B":return new Bishop(n);case"N":return new Knight(n);default:return}},n}(),Rook=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Rook",e.radius=new Radius,e}return __extends(t,n),t.prototype.attack=function(){return[]},t.prototype.mobility=function(){return[[new Vector(function(n){return n},function(n){return 0}),!0],[new Vector(function(n){return-n},function(n){return 0}),!0],[new Vector(function(n){return 0},function(n){return n}),!0],[new Vector(function(n){return 0},function(n){return-n}),!0]]},t}(Piece),Pawn=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Pawn",e.radius=new Radius(2),e}return __extends(t,n),t.prototype.attack=function(){return[[new Vector(function(n){return 1},function(n){return 1}),!0],[new Vector(function(n){return-1},function(n){return 1}),!0]]},t.prototype.mobility=function(){return[[new Vector(function(n){return 0},function(n){return n}),!0]]},t}(Piece),King=function(n){function t(t){var e=n.call(this,t)||this;return e.name="King",e.radius=new Radius(1),e}return __extends(t,n),t.prototype.attack=function(){return[]},t.prototype.mobility=function(){return[[new Vector(function(n){return 1},function(n){return 0}),!0],[new Vector(function(n){return-1},function(n){return 0}),!0],[new Vector(function(n){return 0},function(n){return 1}),!0],[new Vector(function(n){return 0},function(n){return-1}),!0],[new Vector(function(n){return 1},function(n){return 1}),!0],[new Vector(function(n){return 1},function(n){return-1}),!0],[new Vector(function(n){return-1},function(n){return 1}),!0],[new Vector(function(n){return-1},function(n){return-1}),!0]]},t}(Piece),Queen=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Queen",e.radius=new Radius,e}return __extends(t,n),t.prototype.attack=function(){return[]},t.prototype.mobility=function(){return[[new Vector(function(n){return n},function(n){return 0}),!0],[new Vector(function(n){return-n},function(n){return 0}),!0],[new Vector(function(n){return 0},function(n){return n}),!0],[new Vector(function(n){return 0},function(n){return-n}),!0],[new Vector(function(n){return n},function(n){return n}),!0],[new Vector(function(n){return n},function(n){return-n}),!0],[new Vector(function(n){return-n},function(n){return n}),!0],[new Vector(function(n){return-n},function(n){return-n}),!0]]},t}(Piece),Bishop=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Bishop",e.radius=new Radius,e}return __extends(t,n),t.prototype.attack=function(){return[]},t.prototype.mobility=function(){return[[new Vector(function(n){return n},function(n){return n}),!0],[new Vector(function(n){return n},function(n){return-n}),!0],[new Vector(function(n){return-n},function(n){return n}),!0],[new Vector(function(n){return-n},function(n){return-n}),!0]]},t}(Piece),Knight=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Knight",e.radius=new Radius(1),e}return __extends(t,n),t.prototype.attack=function(){return[]},t.prototype.mobility=function(){return[[new Vector(function(n){return 2},function(n){return 1}),!0],[new Vector(function(n){return 2},function(n){return-1}),!0],[new Vector(function(n){return-2},function(n){return 1}),!0],[new Vector(function(n){return-2},function(n){return-1}),!0],[new Vector(function(n){return 1},function(n){return 2}),!0],[new Vector(function(n){return 1},function(n){return-2}),!0],[new Vector(function(n){return-1},function(n){return 2}),!0],[new Vector(function(n){return-1},function(n){return-2}),!0]]},t}(Piece),Square=function(){function n(n,t){return this.candidates=[],this.m=n,this.n=t,this}return n.coords=function(n){return[parseInt(n.slice(1))-1,n.charCodeAt(0)-97]},n.prototype.char=function(n){return String.fromCharCode(n+97)},n.prototype.code=function(){return""+this.char(this.n)+(this.m+1)},n.prototype.accessible=function(){return this.m>=3&&this.m<=10&&this.n>=0&&this.n<=2||this.m>=0&&this.m<=13&&this.n>=3&&this.n<=10||this.m>=3&&this.m<=10&&this.n>=11&&this.n<=13},n}(),Board=function(){function n(){this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var t=0;t<14;t++)this.squares[n][t]=new Square(n,t)}}return n.prototype.square=function(n){var t=Square.coords(n);return this.squares[t[0]][t[1]]},n.prototype.valid=function(n,t){return n>=0&&n<=13&&t>=0&&t<=13},n}(),Turn=function(){return function(n){this.board=new Board,this.index=n}}(),Factory=function(){function n(){this.turns=[]}return n.prototype.piece=function(n){for(var t=0;t<n.length;t++){var e=n[t];if(e instanceof HTMLElement&&0===e.className.indexOf("piece-"))return e}},n.prototype.create=function(n,t){var e=t.addedNodes;if(e.length>=14)for(var r=0;r<14;r++)for(var o=0;o<14;o++){var u=e[r].childNodes[o];if(u instanceof HTMLElement){var i=this.piece(u.childNodes);if(i){var c=i.attributes["data-piece"],a=u.attributes["data-square"];if(c&&a){var s=Piece.create(c.value);n.board.square(a.value).piece=s}}}}},n.prototype.process=function(n){for(var t=0,e=0,r=n;e<r.length;e++){var o=r[e];if("childList"===o.type&&o.target instanceof HTMLElement&&0===o.target.className.indexOf("board-")){var u=new Turn(++t);console.log("turn:"+t),this.create(u,o),this.analyse(u),this.show(u),this.turns.push(u)}}return this},n.prototype.remaining=function(n){for(var t=0,e=0;e<n.length;e++)n[e][1]&&t++;return t},n.prototype.candidates=function(n){for(var t=[],e=0;e<n.candidates.length;e++)t.push(n.candidates[e].player.name+" "+n.candidates[e].name);console.log("candidates:"+t.join(", "))},n.prototype.attacks=function(n,t,e,r){},n.prototype.moves=function(n,t,e,r){var o=t.mobility();for(console.log("begin radius loop");;){var u=t.radius.next();console.log("radius.done:"+u.done),console.log("radius.value:"+u.value);var i=this.remaining(o);if(console.log("remaining:"+i),u.done||u.value>14||0===i){console.log("breaking out of radius loop"),t.radius.reset();break}console.log("begin move loop");for(var c=0;c<o.length;c++)if(o[c][1]){var a=o[c][0].x1(u.value),s=o[c][0].y1(u.value);console.log("x1:"+a+", y1:"+s);var f=t.player.transform(r,e,a,s),l=f[0],p=f[1];if(console.log("x2:"+l+", y2:"+p),n.board.valid(l,p)){var h=n.board.squares[p][l];h.accessible()?(console.log("target:m["+h.m+"], n["+h.n+"], code:"+h.code()),h.candidates.push(t),this.candidates(h),h.piece&&(o[c][1]=!1,console.log("target square has a piece"))):(o[c][1]=!1,console.log("target square is not accessible"))}else o[c][1]=!1,console.log("target square is out of bounds")}console.log("end move loop")}console.log("end radius loop")},n.prototype.analyse=function(n){for(var t=0;t<14;t++)for(var e=0;e<14;e++){var r=n.board.squares[t][e];console.log("square:m["+r.m+"], n["+r.n+"]");var o=r.accessible();if(console.log("accessible:"+o),o){var u=r.piece;u&&(console.log("piece:"+u.player.name+" "+u.name),u.player instanceof Dead||(this.attacks(n,u,t,e),this.moves(n,u,t,e)))}}},n.prototype.show=function(n){for(var t=0;t<14;t++){for(var e=["|"],r=0;r<14;r++){var o=n.board.squares[t][r];e.push(o.piece?o.piece.dp:"[]")}e.push("|");var u=n.board.squares;console.log(e.join(" ")+"%O %O %O %O %O %O %O %O %O %O %O %O %O %O |",u[t][0],u[t][1],u[t][2],u[t][3],u[t][4],u[t][5],u[t][6],u[t][7],u[t][8],u[t][9],u[t][10],u[t][11],u[t][12],u[t][13])}console.groupEnd()},n}();