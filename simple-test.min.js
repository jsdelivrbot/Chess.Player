var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Player=function(){return function(n){switch(n.charAt(0)){case"w":this.name="Red";break;case"g":this.name="Blue";break;case"d":this.name="Dead";break;case"r":this.name="Green";break;case"b":this.name="Yellow";break;default:this.name=void 0}}}(),Vector=function(){return function(n,e){this.dx=n,this.dy=e}}(),Radius=function(){function n(n){this.counter=0,this.max=n}return n.prototype.next=function(){return!this.max||this.max&&this.max>=++this.counter?{value:this.counter,done:!1}:{value:null,done:!0}},n}(),Piece=function(){function n(n){this.player=new Player(n),this.dp=n}return n.create=function(n){switch(n.charAt(1)){case"R":return new Rook(n);case"P":return new Pawn(n);case"K":return new King(n);case"Q":return new Queen(n);case"B":return new Bishop(n);case"N":return new Knight(n);default:return null}},n}(),Rook=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Rook",t.jump=!1,t.radius=new Radius,t.mobility=[new Vector(function(n,e){return n+e},function(n){return n}),new Vector(function(n,e){return n-e},function(n){return n}),new Vector(function(n){return n},function(n,e){return n+e}),new Vector(function(n){return n},function(n,e){return n-e})],t}return __extends(e,n),e}(Piece),Pawn=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Pawn",t.jump=!1,t.radius=new Radius(2),t.mobility=[new Vector(function(n){return n},function(n,e){return n+e})],t}return __extends(e,n),e}(Piece),King=function(n){function e(e){var t=n.call(this,e)||this;return t.name="King",t.jump=!1,t.radius=new Radius(1),t.mobility=[new Vector(function(n){return n+1},function(n){return n}),new Vector(function(n){return n-1},function(n){return n}),new Vector(function(n){return n},function(n){return n+1}),new Vector(function(n){return n},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+1}),new Vector(function(n){return n+1},function(n){return n-1}),new Vector(function(n){return n-1},function(n){return n+1}),new Vector(function(n){return n-1},function(n){return n-1})],t}return __extends(e,n),e}(Piece),Queen=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Queen",t.jump=!1,t.radius=new Radius,t.mobility=[new Vector(function(n,e){return n+e},function(n){return n}),new Vector(function(n,e){return n-e},function(n){return n}),new Vector(function(n){return n},function(n,e){return n+e}),new Vector(function(n){return n},function(n,e){return n-e}),new Vector(function(n,e){return n+e},function(n,e){return n+e}),new Vector(function(n,e){return n+e},function(n,e){return n-e}),new Vector(function(n,e){return n-e},function(n,e){return n+e}),new Vector(function(n,e){return n-e},function(n,e){return n-e})],t}return __extends(e,n),e}(Piece),Bishop=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Bishop",t.jump=!1,t.radius=new Radius,t.mobility=[new Vector(function(n,e){return n+e},function(n,e){return n+e}),new Vector(function(n,e){return n+e},function(n,e){return n-e}),new Vector(function(n,e){return n-e},function(n,e){return n+e}),new Vector(function(n,e){return n-e},function(n,e){return n-e})],t}return __extends(e,n),e}(Piece),Knight=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Knight",t.jump=!0,t.radius=new Radius(1),t.mobility=[new Vector(function(n){return n+2},function(n){return n+1}),new Vector(function(n){return n+2},function(n){return n-1}),new Vector(function(n){return n-2},function(n){return n+1}),new Vector(function(n){return n-2},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+2}),new Vector(function(n){return n+1},function(n){return n-2}),new Vector(function(n){return n-1},function(n){return n+2}),new Vector(function(n){return n-1},function(n){return n-2})],t}return __extends(e,n),e}(Piece),Square=function(){function n(n){var e;e=this.convert(n),this.m=e[0],this.n=e[1],this.code=n}return n.prototype.convert=function(n){return[n.charCodeAt(0),parseInt(n.slice(1))]},n}(),DiffSquare=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e}(Square),Board=function(){function n(){this.squares=[]}return n.prototype.add=function(n){this.squares[n.m][n.n]=n},n}(),Diff=function(){function n(){this.deaths=[],this.captures=[],this.removals=[],this.additions=[],this.squares=[]}return n.prototype.add=function(n){this.squares[n.m][n.n]=n},n}(),Turn=function(){return function(n){this.index=n,this.diff=new Diff,this.added=new Board,this.removed=new Board}}(),Factory=function(){function n(){this.turns=[]}return n.prototype.piece=function(n){for(var e=0;e<n.length;e++){var t=n[e];if(t instanceof HTMLElement&&0===t.className.indexOf("piece-"))return t}},n.prototype.process=function(n){var e=this;return Rx.Observable.fromArray(n).filter(function(n){return"childList"===n.type&&n.target instanceof HTMLElement&&0===n.target.className.indexOf("board-")}).scan(function(n,e){return[e,++n[1]]},[void 0,0]).forEach(function(n){var t,r;t=n[0],r=n[1];var u=new Turn(r);e.turns.push(u);for(var i=0;i<14;i++)for(var o=t[i].addedNodes,c=t[i].removedNodes,a=0;a<14;a++){var s=o[i].childNodes[a],f=c[i].childNodes[a];if(s instanceof HTMLElement&&f instanceof HTMLElement){var d=e.piece(s.childNodes),h=e.piece(f.childNodes),p=new Square(s.dataset.square),l=new Square(f.dataset.square),w=new DiffSquare(s.dataset.square);d&&(p.piece=Piece.create(d.attributes["data-piece"].value)),h&&(l.piece=Piece.create(h.attributes["data-piece"].value)),!l.piece&&p.piece&&(u.diff.additions.push(p),w.piece=p.piece,w.change="+"),l.piece&&!p.piece&&(u.diff.removals.push(l),w.piece=l.piece,w.change="-"),l.piece&&p.piece&&l.piece.dp!==p.piece.dp&&(w.piece=p.piece,"Dead"===p.piece.player.name?(u.diff.deaths.push(p),w.change="x"):(u.diff.captures.push(p),w.change="*")),u.removed.add(l),u.added.add(p),u.diff.add(w)}}}),this},n.prototype.header=function(n){return"Index: "+n.index+"; Additions: "+n.diff.additions.length+"; Removals: "+n.diff.removals.length+"; Captures: "+n.diff.captures.length+"; Deaths: "+n.diff.deaths.length},n.prototype.show=function(n){for(var e=1;e<Math.min(this.turns.length,n);e++){var t=this.turns[e];console.group(this.header(t));for(var r=0;r<14;r++){for(var u=["|"],i=0;i<14;i++){var o=t.added.squares[r][i];u.push(o.piece?o.piece.dp:"[]")}u.push("|");for(i=0;i<14;i++){o=t.removed.squares[r][i];u.push(o.piece?o.piece.dp:"[]")}u.push("|");for(i=0;i<14;i++){o=t.diff.squares[r][i];u.push(o.piece?o.piece.dp+o.change:"[ ]")}u.push("|"),console.log(u.join(" "))}console.groupEnd()}return this},n}();