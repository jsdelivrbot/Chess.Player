var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Player=function(){return function(n){switch(n.charAt(0)){case"w":this.name="Red";break;case"g":this.name="Blue";break;case"d":this.name="Dead";break;case"r":this.name="Green";break;case"b":this.name="Yellow";break;default:this.name=void 0}}}(),Vector=function(){return function(n,e){this.dx=n,this.dy=e}}(),Radius=function(){function n(n){this.counter=0,this.max=n}return n.prototype.next=function(){return!this.max||this.max&&this.max>=++this.counter?{value:this.counter,done:!1}:{value:null,done:!0}},n}(),Piece=function(){function n(n){this.player=new Player(n),this.dp=n}return n.create=function(n){switch(n.charAt(1)){case"R":return new Rook(n);case"P":return new Pawn(n);case"K":return new King(n);case"Q":return new Queen(n);case"B":return new Bishop(n);case"N":return new Knight(n);default:return null}},n}(),Rook=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Rook",t.jump=!1,t.radius=new Radius,t.mobility=[new Vector(function(n,e){return n+e},function(n){return n}),new Vector(function(n,e){return n-e},function(n){return n}),new Vector(function(n){return n},function(n,e){return n+e}),new Vector(function(n){return n},function(n,e){return n-e})],t}return __extends(e,n),e}(Piece),Pawn=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Pawn",t.jump=!1,t.radius=new Radius(2),t.mobility=[new Vector(function(n){return n},function(n,e){return n+e})],t}return __extends(e,n),e}(Piece),King=function(n){function e(e){var t=n.call(this,e)||this;return t.name="King",t.jump=!1,t.radius=new Radius(1),t.mobility=[new Vector(function(n){return n+1},function(n){return n}),new Vector(function(n){return n-1},function(n){return n}),new Vector(function(n){return n},function(n){return n+1}),new Vector(function(n){return n},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+1}),new Vector(function(n){return n+1},function(n){return n-1}),new Vector(function(n){return n-1},function(n){return n+1}),new Vector(function(n){return n-1},function(n){return n-1})],t}return __extends(e,n),e}(Piece),Queen=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Queen",t.jump=!1,t.radius=new Radius,t.mobility=[new Vector(function(n,e){return n+e},function(n){return n}),new Vector(function(n,e){return n-e},function(n){return n}),new Vector(function(n){return n},function(n,e){return n+e}),new Vector(function(n){return n},function(n,e){return n-e}),new Vector(function(n,e){return n+e},function(n,e){return n+e}),new Vector(function(n,e){return n+e},function(n,e){return n-e}),new Vector(function(n,e){return n-e},function(n,e){return n+e}),new Vector(function(n,e){return n-e},function(n,e){return n-e})],t}return __extends(e,n),e}(Piece),Bishop=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Bishop",t.jump=!1,t.radius=new Radius,t.mobility=[new Vector(function(n,e){return n+e},function(n,e){return n+e}),new Vector(function(n,e){return n+e},function(n,e){return n-e}),new Vector(function(n,e){return n-e},function(n,e){return n+e}),new Vector(function(n,e){return n-e},function(n,e){return n-e})],t}return __extends(e,n),e}(Piece),Knight=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Knight",t.jump=!0,t.radius=new Radius(1),t.mobility=[new Vector(function(n){return n+2},function(n){return n+1}),new Vector(function(n){return n+2},function(n){return n-1}),new Vector(function(n){return n-2},function(n){return n+1}),new Vector(function(n){return n-2},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+2}),new Vector(function(n){return n+1},function(n){return n-2}),new Vector(function(n){return n-1},function(n){return n+2}),new Vector(function(n){return n-1},function(n){return n-2})],t}return __extends(e,n),e}(Piece),Square=function(){function n(){}return n.prototype.initFromCode=function(n){return this.n=parseInt(n.slice(1)),this.m=n.charCodeAt(0),this.code=n,this},n.prototype.initFromCoords=function(n,e){return this.code=""+String.fromCharCode(e+97)+(n+1),this.m=n,this.n=e,this},n}(),DiffSquare=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e}(Square),Board=function(){function n(){this.squares=[]}return n.prototype.add=function(n){this.squares[n.m][n.n]=n},n}(),Diff=function(){function n(){this.deaths=[],this.captures=[],this.removals=[],this.additions=[],this.squares=[]}return n.prototype.add=function(n){this.squares[n.m][n.n]=n},n}(),Turn=function(){return function(n){this.index=n,this.diff=new Diff,this.added=new Board,this.removed=new Board}}(),Factory=function(){function n(){this.turns=[]}return n.prototype.piece=function(n){for(var e=0;e<n.length;e++){var t=n[e];if(t instanceof HTMLElement&&0===t.className.indexOf("piece-"))return t}},n.prototype.process=function(n){var e=this;return Rx.Observable.fromArray(n).filter(function(n){return"childList"===n.type&&n.target instanceof HTMLElement&&0===n.target.className.indexOf("board-")}).scan(function(n,e){return[e,++n[1]]},[void 0,0]).forEach(function(n){var t,r;t=n[0],r=n[1];var o=new Turn(r);e.turns.push(o);var i=t.addedNodes,u=t.removedNodes;if(0!==i.length&&0!==u.length){console.log("A");for(var c=0;c<14;c++){console.log("B");for(var s=0;s<14;s++){console.log("C");var a=i[c].childNodes[s],f=u[c].childNodes[s];if(a instanceof HTMLElement&&f instanceof HTMLElement){console.log("D");var d=e.piece(a.childNodes),h=e.piece(f.childNodes),l=(new Square).initFromCode(a.dataset.square),p=(new Square).initFromCode(f.dataset.square),w=(new DiffSquare).initFromCode(a.dataset.square);console.log("E"),d&&(console.log("F"),l.piece=Piece.create(d.attributes["data-piece"].value),console.log("G")),console.log("H"),h&&(console.log("I"),p.piece=Piece.create(h.attributes["data-piece"].value),console.log("J")),console.log("K"),!p.piece&&l.piece&&(o.diff.additions.push(l),w.piece=l.piece,w.change="+"),console.log("L"),p.piece&&!l.piece&&(o.diff.removals.push(p),w.piece=p.piece,w.change="-"),console.log("M"),p.piece&&l.piece&&p.piece.dp!==l.piece.dp&&(w.piece=l.piece,"Dead"===l.piece.player.name?(o.diff.deaths.push(l),w.change="x"):(o.diff.captures.push(l),w.change="*")),console.log("N: %O",p),o.removed.add(p),console.log("O"),o.added.add(l),console.log("P"),o.diff.add(w),console.log("Q")}}}}}),this},n.prototype.header=function(n){return"Index: "+n.index+"; Additions: "+n.diff.additions.length+"; Removals: "+n.diff.removals.length+"; Captures: "+n.diff.captures.length+"; Deaths: "+n.diff.deaths.length},n.prototype.show=function(n){for(var e=1;e<Math.min(this.turns.length,n);e++){var t=this.turns[e];console.group(this.header(t));for(var r=0;r<14;r++){for(var o=["|"],i=0;i<14;i++){var u=t.added.squares[r][i];o.push(u.piece?u.piece.dp:"[]")}o.push("|");for(i=0;i<14;i++){u=t.removed.squares[r][i];o.push(u.piece?u.piece.dp:"[]")}o.push("|");for(i=0;i<14;i++){u=t.diff.squares[r][i];o.push(u.piece?u.piece.dp+u.change:"[ ]")}o.push("|"),console.log(o.join(" "))}console.groupEnd()}return this},n}();