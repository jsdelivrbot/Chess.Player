var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Player=function(){function n(){}return n.create=function(n){switch(n.charAt(0)){case"w":return new Red;case"g":return new Blue;case"b":return new Yellow;case"r":return new Green;case"d":return new Dead;default:return}},n}(),Red=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.name="Red",e.turn=1,e}return __extends(e,n),e.prototype.transform=function(n,e){return[n,e]},e}(Player),Blue=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.name="Blue",e.turn=2,e}return __extends(e,n),e.prototype.transform=function(n,e){return[-e,n]},e}(Player),Yellow=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.name="Yellow",e.turn=3,e}return __extends(e,n),e.prototype.transform=function(n,e){return[-n,-e]},e}(Player),Green=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.name="Green",e.turn=4,e}return __extends(e,n),e.prototype.transform=function(n,e){return[e,-n]},e}(Player),Dead=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.name="Dead",e.turn=0,e}return __extends(e,n),e.prototype.transform=function(n,e){throw new Error("Not implemented")},e}(Player),Vector=function(){return function(n,e){this.dx=n,this.dy=e}}(),Radius=function(){function n(n){this.counter=0,this.max=n}return n.prototype.next=function(){return!this.max||this.max>=this.counter?(this.counter++,{value:this.counter,done:!1}):(this.counter=0,{value:void 0,done:!0})},n}(),Piece=function(){function n(n){this.player=Player.create(n),this.dp=n}return n.create=function(n){switch(n.charAt(1)){case"R":return new Rook(n);case"P":return new Pawn(n);case"K":return new King(n);case"Q":return new Queen(n);case"B":return new Bishop(n);case"N":return new Knight(n);default:return}},n}(),Rook=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Rook",t.radius=new Radius,t.attack=[],t.mobility=[new Vector(function(n,e){return n+e},function(n){return n}),new Vector(function(n,e){return n-e},function(n){return n}),new Vector(function(n){return n},function(n,e){return n+e}),new Vector(function(n){return n},function(n,e){return n-e})],t}return __extends(e,n),e}(Piece),Pawn=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Pawn",t.radius=new Radius(2),t.attack=[new Vector(function(n){return n+1},function(n){return n+1}),new Vector(function(n){return n-1},function(n){return n+1})],t.mobility=[new Vector(function(n){return n},function(n,e){return n+e})],t}return __extends(e,n),e}(Piece),King=function(n){function e(e){var t=n.call(this,e)||this;return t.name="King",t.radius=new Radius(1),t.attack=[],t.mobility=[new Vector(function(n){return n+1},function(n){return n}),new Vector(function(n){return n-1},function(n){return n}),new Vector(function(n){return n},function(n){return n+1}),new Vector(function(n){return n},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+1}),new Vector(function(n){return n+1},function(n){return n-1}),new Vector(function(n){return n-1},function(n){return n+1}),new Vector(function(n){return n-1},function(n){return n-1})],t}return __extends(e,n),e}(Piece),Queen=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Queen",t.radius=new Radius,t.attack=[],t.mobility=[new Vector(function(n,e){return n+e},function(n){return n}),new Vector(function(n,e){return n-e},function(n){return n}),new Vector(function(n){return n},function(n,e){return n+e}),new Vector(function(n){return n},function(n,e){return n-e}),new Vector(function(n,e){return n+e},function(n,e){return n+e}),new Vector(function(n,e){return n+e},function(n,e){return n-e}),new Vector(function(n,e){return n-e},function(n,e){return n+e}),new Vector(function(n,e){return n-e},function(n,e){return n-e})],t}return __extends(e,n),e}(Piece),Bishop=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Bishop",t.radius=new Radius,t.attack=[],t.mobility=[new Vector(function(n,e){return n+e},function(n,e){return n+e}),new Vector(function(n,e){return n+e},function(n,e){return n-e}),new Vector(function(n,e){return n-e},function(n,e){return n+e}),new Vector(function(n,e){return n-e},function(n,e){return n-e})],t}return __extends(e,n),e}(Piece),Knight=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Knight",t.radius=new Radius(1),t.attack=[],t.mobility=[new Vector(function(n){return n+2},function(n){return n+1}),new Vector(function(n){return n+2},function(n){return n-1}),new Vector(function(n){return n-2},function(n){return n+1}),new Vector(function(n){return n-2},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+2}),new Vector(function(n){return n+1},function(n){return n-2}),new Vector(function(n){return n-1},function(n){return n+2}),new Vector(function(n){return n-1},function(n){return n-2})],t}return __extends(e,n),e}(Piece),Square=function(){function n(n,e){return this.m=n,this.n=e,this}return n.coords=function(n){return[parseInt(n.slice(1))-1,n.charCodeAt(0)-97]},n.prototype.char=function(n){return String.fromCharCode(n+97)},n.prototype.code=function(){return""+this.char(this.n)+(this.m+1)},n.prototype.accessible=function(){return this.m>=3&&this.m<=10&&this.n>=0&&this.n<=2||this.m>=0&&this.m<=13&&this.n>=3&&this.n<=10||this.m>=3&&this.m<=10&&this.n>=11&&this.n<=13},n}(),DiffSquare=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e}(Square),AnalysisSquare=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.candidates=[],e}return __extends(e,n),e}(Square),Board=function(){function n(){this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var e=0;e<14;e++)this.squares[n][e]=new Square(n,e)}}return n.prototype.square=function(n){var e=Square.coords(n);return this.squares[e[0]][e[1]]},n.prototype.valid=function(n,e){return n>=0&&n<=13&&e>=0&&e<=13},n}(),Diff=function(){function n(){this.deaths=[],this.captures=[],this.removals=[],this.additions=[],this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var e=0;e<14;e++)this.squares[n][e]=new DiffSquare(n,e)}}return n.prototype.square=function(n){var e=DiffSquare.coords(n);return this.squares[e[0]][e[1]]},n}(),Analysis=function(){function n(){this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var e=0;e<14;e++)this.squares[n][e]=new AnalysisSquare(n,e)}}return n.prototype.square=function(n){var e=AnalysisSquare.coords(n);return this.squares[e[0]][e[1]]},n}(),Turn=function(){return function(n){this.diff=new Diff,this.added=new Board,this.removed=new Board,this.analysis=new Analysis,this.index=n}}(),Factory=function(){function n(){this.turns=[]}return n.prototype.piece=function(n){for(var e=0;e<n.length;e++){var t=n[e];if(t instanceof HTMLElement&&0===t.className.indexOf("piece-"))return t}},n.prototype.createBoards=function(n,e){var t=e.removedNodes,r=e.addedNodes;if(r.length>=14&&t.length>=14)for(var o=0;o<14;o++)for(var i=0;i<14;i++){var u=r[o].childNodes[i],s=t[o].childNodes[i];if(u instanceof HTMLElement&&s instanceof HTMLElement){var c=this.piece(u.childNodes),a=this.piece(s.childNodes);if(c){var f=c.attributes["data-piece"],l=u.attributes["data-square"];if(f&&l){var d=Piece.create(f.value);n.added.square(l.value).piece=d}}if(a){f=a.attributes["data-piece"],l=s.attributes["data-square"];if(f&&l){d=Piece.create(f.value);n.removed.square(l.value).piece=d}}}}},n.prototype.createDiffBoard=function(n){for(var e=0;e<14;e++)for(var t=0;t<14;t++){var r=n.removed.squares[e][t],o=n.added.squares[e][t],i=n.diff.squares[e][t];!r.piece&&o.piece&&(n.diff.additions.push(o),i.piece=o.piece,i.change="+"),r.piece&&!o.piece&&(n.diff.removals.push(r),i.piece=r.piece,i.change="-"),r.piece&&o.piece&&r.piece.dp!==o.piece.dp&&(i.piece=o.piece,o.piece.player instanceof Dead?(n.diff.deaths.push(o),i.change="x"):(n.diff.captures.push(o),i.change="*"))}},n.prototype.process=function(n){for(var e=0,t=0,r=n;t<r.length;t++){var o=r[t];if("childList"===o.type&&o.target instanceof HTMLElement&&0===o.target.className.indexOf("board-")){var i=new Turn(++e);this.createBoards(i,o),this.createDiffBoard(i),this.turns.push(i)}}return this},n.prototype.analyse=function(){for(var n=1;n<this.turns.length;n++){console.group("turn:%i",n);var e=new Analysis,t=this.turns[n],r=t.added;console.log("analysing");for(var o=0;o<14;o++)for(var i=0;i<14;i++){var u=r.squares[o][i];if(console.log("square:m[%i], n[%i]",u.m,u.n),console.log("accessible:%s",u.accessible()),u.accessible()){var s=u.piece;if(s){var c=s.player;if(console.log("piece:%s %s",c.name,s.name),!(c instanceof Dead)){var a=c.transform(i,o),f=a[0],l=a[1];console.log("x:%i, y:%i",f,l);for(var d=0,h=s.mobility;d<h.length;d++){var p=h[d];console.log("begin move loop");for(var v=!1,w=s.radius.next();!w.done&&!v;){console.log("begin radius loop"),console.log("restricted:%s",v),console.log("result.done:%s",w.done);var y=w.value,m=p.dy(l,y),g=p.dx(f,y);if(console.log("radius:%i, dx:%i, dy:%i",y,g,m),r.valid(g,m)){var q=r.squares[m][g];if(console.log("target:m[%i], n[%i]",q.m,q.n),q.accessible()){var _=q.code(),V=e.square(_);console.log("code:%s, goal:m[%i], n[%i]",_,V.m,V.n),V.candidates.push(s);var x=[];for(var b in V.candidates)x.push(c.name+" "+s.name);console.log("candidates:",x.join(" ")),V.piece&&(v=!0,console.log("goal has piece. restricted set to true"))}else v=!0,console.log("target not accessible. restricted set to true")}else v=!0,console.log("square not valid. restricted set to true");w=s.radius.next(),console.log("new result. done:%s, value:%s",w.done,w.value),console.log("end radius loop")}console.log("end move loop")}}}}}t.analysis=e,console.groupEnd()}return this},n.prototype.header=function(n){return"Index: "+n.index+"; Additions: "+n.diff.additions.length+"; Removals: "+n.diff.removals.length+"; Captures: "+n.diff.captures.length+"; Deaths: "+n.diff.deaths.length},n.prototype.show=function(n){for(var e=1;e<Math.min(this.turns.length,n);e++){var t=this.turns[e];console.group(this.header(t)),console.log("                                                                                                          0   1   2   3   4   5   6   7   8   9  10  11  12  13");for(var r=0;r<14;r++){for(var o=["|"],i=0;i<14;i++){var u=t.added.squares[r][i];o.push(u.piece?u.piece.dp:"[]")}o.push("|");for(i=0;i<14;i++){u=t.diff.squares[r][i];o.push(u.piece?u.piece.dp+u.change:"[ ]")}o.push("|");var s=t.analysis.squares;console.log(o.join(" ")+"%i %O %O %O %O %O %O %O %O %O %O %O %O %O %O |",r,s[r][0],s[r][1],s[r][2],s[r][3],s[r][4],s[r][5],s[r][6],s[r][7],s[r][8],s[r][9],s[r][10],s[r][11],s[r][12],s[r][13])}console.groupEnd()}return this},n}();