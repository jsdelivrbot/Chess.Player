var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])};return function(n,t){function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Player=function(){return function(e){switch(e.charAt(0)){case"w":this.name="Red";break;case"g":this.name="Blue";break;case"d":this.name="Dead";break;case"r":this.name="Green";break;case"b":this.name="Yellow";break;default:this.name=void 0}}}(),Vector=function(){return function(e,n){this.dx=e,this.dy=n}}(),Radius=function(){function e(e){this.counter=0,this.max=e}return e.prototype.next=function(){return!this.max||this.max&&this.max>=++this.counter?{value:this.counter,done:!1}:{value:null,done:!0}},e}(),Piece=function(){function e(e){this.player=new Player(e),this.dp=e}return e.create=function(e){switch(e.charAt(1)){case"R":return new Rook(e);case"P":return new Pawn(e);case"K":return new King(e);case"Q":return new Queen(e);case"B":return new Bishop(e);case"N":return new Knight(e);default:return}},e}(),Rook=function(e){function n(n){var t=e.call(this,n)||this;return t.name="Rook",t.jump=!1,t.radius=new Radius,t.mobility=[new Vector(function(e,n){return e+n},function(e){return e}),new Vector(function(e,n){return e-n},function(e){return e}),new Vector(function(e){return e},function(e,n){return e+n}),new Vector(function(e){return e},function(e,n){return e-n})],t}return __extends(n,e),n}(Piece),Pawn=function(e){function n(n){var t=e.call(this,n)||this;return t.name="Pawn",t.jump=!1,t.radius=new Radius(2),t.mobility=[new Vector(function(e){return e},function(e,n){return e+n})],t}return __extends(n,e),n}(Piece),King=function(e){function n(n){var t=e.call(this,n)||this;return t.name="King",t.jump=!1,t.radius=new Radius(1),t.mobility=[new Vector(function(e){return e+1},function(e){return e}),new Vector(function(e){return e-1},function(e){return e}),new Vector(function(e){return e},function(e){return e+1}),new Vector(function(e){return e},function(e){return e-1}),new Vector(function(e){return e+1},function(e){return e+1}),new Vector(function(e){return e+1},function(e){return e-1}),new Vector(function(e){return e-1},function(e){return e+1}),new Vector(function(e){return e-1},function(e){return e-1})],t}return __extends(n,e),n}(Piece),Queen=function(e){function n(n){var t=e.call(this,n)||this;return t.name="Queen",t.jump=!1,t.radius=new Radius,t.mobility=[new Vector(function(e,n){return e+n},function(e){return e}),new Vector(function(e,n){return e-n},function(e){return e}),new Vector(function(e){return e},function(e,n){return e+n}),new Vector(function(e){return e},function(e,n){return e-n}),new Vector(function(e,n){return e+n},function(e,n){return e+n}),new Vector(function(e,n){return e+n},function(e,n){return e-n}),new Vector(function(e,n){return e-n},function(e,n){return e+n}),new Vector(function(e,n){return e-n},function(e,n){return e-n})],t}return __extends(n,e),n}(Piece),Bishop=function(e){function n(n){var t=e.call(this,n)||this;return t.name="Bishop",t.jump=!1,t.radius=new Radius,t.mobility=[new Vector(function(e,n){return e+n},function(e,n){return e+n}),new Vector(function(e,n){return e+n},function(e,n){return e-n}),new Vector(function(e,n){return e-n},function(e,n){return e+n}),new Vector(function(e,n){return e-n},function(e,n){return e-n})],t}return __extends(n,e),n}(Piece),Knight=function(e){function n(n){var t=e.call(this,n)||this;return t.name="Knight",t.jump=!0,t.radius=new Radius(1),t.mobility=[new Vector(function(e){return e+2},function(e){return e+1}),new Vector(function(e){return e+2},function(e){return e-1}),new Vector(function(e){return e-2},function(e){return e+1}),new Vector(function(e){return e-2},function(e){return e-1}),new Vector(function(e){return e+1},function(e){return e+2}),new Vector(function(e){return e+1},function(e){return e-2}),new Vector(function(e){return e-1},function(e){return e+2}),new Vector(function(e){return e-1},function(e){return e-2})],t}return __extends(n,e),n}(Piece),Square=function(){function e(e,n){return this.code=this.codegen(e,n),this.m=e,this.n=n,this}return e.coords=function(e){return[parseInt(e.slice(1))-1,e.charCodeAt(0)-97]},e.prototype.char=function(e){return String.fromCharCode(e+97)},e.prototype.codegen=function(e,n){return""+this.char(n)+(e+1)},e}(),DiffSquare=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n}(Square),Board=function(){function e(){this.squares=[];for(var e=0;e<14;e++){this.squares[e]=[];for(var n=0;n<14;n++)this.squares[e][n]=new Square(e,n)}}return e.prototype.square=function(e){var n=Square.coords(e);return this.squares[n[0]][n[1]]},e}(),Diff=function(){function e(){this.deaths=[],this.captures=[],this.removals=[],this.additions=[],this.squares=[];for(var e=0;e<14;e++){this.squares[e]=[];for(var n=0;n<14;n++)this.squares[e][n]=new DiffSquare(e,n)}}return e.prototype.square=function(e){var n=DiffSquare.coords(e);return this.squares[n[0]][n[1]]},e}(),Turn=function(){return function(e){this.diff=new Diff,this.added=new Board,this.removed=new Board,this.index=e}}(),Factory=function(){function e(){this.turns=[]}return e.prototype.piece=function(e){for(var n=0;n<e.length;n++){var t=e[n];if(t instanceof HTMLElement&&0===t.className.indexOf("piece-"))return t}},e.prototype.createAddedAndRemovedBoards=function(e,n){var t=n.removedNodes,r=n.addedNodes;if(r.length>=14&&t.length>=14)for(var u=0;u<14;u++)for(var i=0;i<14;i++){var o=r[u].childNodes[i],c=t[u].childNodes[i];if(o instanceof HTMLElement&&c instanceof HTMLElement){var a=this.piece(o.childNodes),s=this.piece(c.childNodes);if(a){var f=a.attributes["data-piece"],d=o.attributes["data-square"];if(f&&d){var h=Piece.create(f.value);e.added.square(d.value).piece=h}}if(s){f=s.attributes["data-piece"],d=c.attributes["data-square"];if(f&&d){h=Piece.create(f.value);e.removed.square(d.value).piece=h}}}}},e.prototype.createDiffBoard=function(e){for(var n=0;n<14;n++)for(var t=0;t<14;t++){var r=e.removed.squares[n][t],u=e.added.squares[n][t],i=e.diff.squares[n][t];!r.piece&&u.piece&&(e.diff.additions.push(u),i.piece=u.piece,i.change="+"),r.piece&&!u.piece&&(e.diff.removals.push(r),i.piece=r.piece,i.change="-"),r.piece&&u.piece&&r.piece.dp!==u.piece.dp&&(i.piece=u.piece,"Dead"===u.piece.player.name?(e.diff.deaths.push(u),i.change="x"):(e.diff.captures.push(u),i.change="*"))}},e.prototype.process=function(e){var n=this;return Rx.Observable.fromArray(e).filter(function(e){return"childList"===e.type&&e.target instanceof HTMLElement&&0===e.target.className.indexOf("board-")}).scan(function(e,n){return[n,++e[1]]},[void 0,0]).subscribe(function(e){var t=new Turn(e[1]);n.createAddedAndRemovedBoards(t,e[0]),n.createDiffBoard(t),n.turns.push(t)}),this},e.prototype.header=function(e){return"Index: "+e.index+"; Additions: "+e.diff.additions.length+"; Removals: "+e.diff.removals.length+"; Captures: "+e.diff.captures.length+"; Deaths: "+e.diff.deaths.length},e.prototype.show=function(e){for(var n=1;n<Math.min(this.turns.length,e);n++){var t=this.turns[n];console.group(this.header(t));for(var r=0;r<14;r++){for(var u=["|"],i=0;i<14;i++){var o=t.added.squares[r][i];u.push(o.piece?o.piece.dp:"[]")}u.push("|");for(i=0;i<14;i++){o=t.removed.squares[r][i];u.push(o.piece?o.piece.dp:"[]")}u.push("|");for(i=0;i<14;i++){o=t.diff.squares[r][i];u.push(o.piece?o.piece.dp+o.change:"[ ]")}u.push("|"),console.log(u.join(" "))}console.groupEnd()}return this},e}();