!function(){"use strict";var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function e(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return function(t,e){this.x1=t,this.y1=e}}(),r=function(){return function(){}}(),i=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Yellow",e.turn=3,e}return e(n,t),n.prototype.rotate=function(t,e,n,r){return[t-n,e-r]},n}(r),o=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Green",e.turn=4,e}return e(n,t),n.prototype.rotate=function(t,e,n,r){return[t-r,e+n]},n}(r),a=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Blue",e.turn=2,e}return e(n,t),n.prototype.rotate=function(t,e,n,r){return[t+r,e-n]},n}(r),u=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Dead",e.turn=0,e}return e(n,t),n.prototype.rotate=function(t,e){throw new Error("Not implemented")},n}(r),s=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Red",e.turn=1,e}return e(n,t),n.prototype.rotate=function(t,e,n,r){return[t+n,e+r]},n}(r),c=function(){function t(t,e){return this.m=t,this.n=e,this}return t.prototype.char=function(t){return String.fromCharCode(t+97)},t.prototype.code=function(){return""+this.char(this.n)+(this.m+1)},t.prototype.accessible=function(){return this.m>=3&&this.m<=10&&this.n>=0&&this.n<=2||this.m>=0&&this.m<=13&&this.n>=3&&this.n<=10||this.m>=3&&this.m<=10&&this.n>=11&&this.n<=13},t.coords=function(t){return[parseInt(t.slice(1))-1,t.charCodeAt(0)-97]},t}(),f=function(){function t(t,e){this.player=this.createPlayer(t),this.coords=c.coords(e),this.counter=0,this.dp=t}return t.prototype.moved=function(){for(var t=!0,e=0;e<this.home.length;e++){var n=this.home[e][0]-6.5,r=this.home[e][1]-6.5,i=this.player.rotate(6.5,6.5,r,n),o=i[0],a=i[1];if(this.coords[1]===o&&this.coords[0]===a){t=!1;break}}return t},t.prototype.radius=function(){for(;!this.max||this.counter<this.max;)return this.counter++,{value:this.counter,done:!1};return this.counter=0,{value:void 0,done:!0}},t.prototype.createPlayer=function(t){switch(t.charAt(0)){case"w":return new s;case"g":return new a;case"b":return new i;case"r":return new o;case"d":return new u;default:return}},t}(),l=function(t){function r(e,n){var r=t.call(this,e,n)||this;return r.name="Knight",r.home=[[0,4],[0,9]],r.max=1,r}return e(r,t),r.prototype.moves=function(){return[]},r.prototype.attacks=function(){return[[new n(function(t){return 2},function(t){return 1}),!0],[new n(function(t){return 2},function(t){return-1}),!0],[new n(function(t){return-2},function(t){return 1}),!0],[new n(function(t){return-2},function(t){return-1}),!0],[new n(function(t){return 1},function(t){return 2}),!0],[new n(function(t){return 1},function(t){return-2}),!0],[new n(function(t){return-1},function(t){return 2}),!0],[new n(function(t){return-1},function(t){return-2}),!0]]},r}(f),h=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Bishop",e.home=[[0,5],[0,8]],e}return e(r,t),r.prototype.moves=function(){return[]},r.prototype.attacks=function(){return[[new n(function(t){return t},function(t){return t}),!0],[new n(function(t){return t},function(t){return-t}),!0],[new n(function(t){return-t},function(t){return t}),!0],[new n(function(t){return-t},function(t){return-t}),!0]]},r}(f),d=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Queen",e.home=e.player instanceof s||e.player instanceof i?[[0,6]]:[[0,7]],e}return e(r,t),r.prototype.moves=function(){return[]},r.prototype.attacks=function(){return[[new n(function(t){return t},function(t){return 0}),!0],[new n(function(t){return-t},function(t){return 0}),!0],[new n(function(t){return 0},function(t){return t}),!0],[new n(function(t){return 0},function(t){return-t}),!0],[new n(function(t){return t},function(t){return t}),!0],[new n(function(t){return t},function(t){return-t}),!0],[new n(function(t){return-t},function(t){return t}),!0],[new n(function(t){return-t},function(t){return-t}),!0]]},r}(f),p=function(t){function r(e,n){var r=t.call(this,e,n)||this;return r.name="King",r.home=r.player instanceof s||r.player instanceof i?[[0,7]]:[[0,6]],r.max=1,r}return e(r,t),r.prototype.moves=function(){return[]},r.prototype.attacks=function(){return[[new n(function(t){return 1},function(t){return 0}),!0],[new n(function(t){return-1},function(t){return 0}),!0],[new n(function(t){return 0},function(t){return 1}),!0],[new n(function(t){return 0},function(t){return-1}),!0],[new n(function(t){return 1},function(t){return 1}),!0],[new n(function(t){return 1},function(t){return-1}),!0],[new n(function(t){return-1},function(t){return 1}),!0],[new n(function(t){return-1},function(t){return-1}),!0]]},r}(f),v=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Rook",e.home=[[0,3],[0,10]],e}return e(r,t),r.prototype.moves=function(){return[]},r.prototype.attacks=function(){return[[new n(function(t){return t},function(t){return 0}),!0],[new n(function(t){return-t},function(t){return 0}),!0],[new n(function(t){return 0},function(t){return t}),!0],[new n(function(t){return 0},function(t){return-t}),!0]]},r}(f),m=function(t){function r(e,n){var r=t.call(this,e,n)||this;return r.name="Pawn",r.home=[[1,3],[1,4],[1,5],[1,6],[1,7],[1,8],[1,9],[1,10]],r.max=1,r}return e(r,t),r.prototype.moves=function(){return this.moved()?[[new n(function(t){return 0},function(t){return 1}),!0]]:[[new n(function(t){return 0},function(t){return 1}),!0],[new n(function(t){return 0},function(t){return 2}),!0]]},r.prototype.attacks=function(){return[[new n(function(t){return t},function(t){return t}),!0],[new n(function(t){return-t},function(t){return t}),!0]]},r}(f),y=function(){function t(){this.squares=[];for(var t=0;t<14;t++){this.squares[t]=[];for(var e=0;e<14;e++)this.squares[t][e]=new c(t,e)}}return t.prototype.square=function(t){var e=c.coords(t);return this.squares[e[0]][e[1]]},t.prototype.valid=function(t,e){return t>=0&&t<=13&&e>=0&&e<=13},t}(),g=function(){function t(){this.colours=["red","blue","yellow","green"],this.board=new y;var t=this.getUsername();this.username=t||"red"}return t.prototype.setOriginSquare=function(t){var e=this.getThisSquareElement(event.target).attributes["data-square"];if(e){var n=document.getElementById("four-player-username"),r=n.attributes.origin;r?r.value=e.value:n.setAttribute("origin",e.value)}},t.prototype.getOriginSquareElement=function(t){var e=document.getElementById("four-player-username").attributes.origin;if(e)return this.getSquareElement(t,e.value)},t.prototype.resetOriginSquareAndCleanSquares=function(){var t=document.getElementById("four-player-username");t.attributes.origin&&t.removeAttribute("origin");var e=this.getBoardElement();this.clearCandidatesFromSquares(e),this.cleanColouredSquares(e)},t.prototype.showMovesAndEnemies=function(t){if(this.username){var e=this.getBoardElement();if(e){var n=this.getOriginSquareElement(e);if(n){var r=this.getThisSquareElement(t);if(r){this.clearCandidatesFromSquares(e),this.cleanColouredSquares(e),this.createBoard(e);var i=n.attributes["data-square"];if(i){var o=this.board.square(i.value);o.piece&&o.piece.player.name.toLowerCase()===this.username&&(this.analyseSquares(e),this.colouriseSquares(e,n,r))}}}}}},t.prototype.showHangingPieces=function(t){if(this.username){var e=this.getBoardElement();if(e)if(!this.getOriginSquareElement(e))this.getThisSquareElement(t)&&(this.clearCandidatesFromSquares(e),this.cleanColouredSquares(e),this.createBoard(e),this.analyseSquares(e),this.colouriseSquaresWithHangingPieces(e))}},t.prototype.getThisSquareElement=function(t){var e;if(t instanceof HTMLElement&&(-1!==t.className.indexOf("piece-")&&(e=t.parentElement),e||(e=t),-1!==e.className.indexOf("square-")))return e},t.prototype.getBoardElement=function(){for(var t,e=document.body.getElementsByTagName("div"),n=0;n<e.length;n++)if(0===e[n].className.indexOf("board-")){var r=e[n];if(r instanceof HTMLElement){t=r;break}}return t},t.prototype.cleanColouredSquares=function(t){var e=document.getElementById("four-player-username"),n=e.attributes.modifications;if(n){var r=t.children;if(!(r.length<14)){for(var i=n.value.split(","),o=0;o<i.length;o++)t:for(var a=0;a<14;a++)for(var u=0;u<14;u++){var s=r[a].children[u],c=s.attributes["data-square"];if(c&&s instanceof HTMLElement&&c.value===i[o]){s.style.backgroundColor=null;break t}}e.removeAttribute("modifications")}}},t.prototype.clearCandidatesFromSquares=function(t){var e=t.children;if(!(e.length<14))for(var n=0;n<14;n++)for(var r=0;r<14;r++){var i=e[n].children[r];i.attributes.attacks&&i.removeAttribute("attacks"),i.attributes.moves&&i.removeAttribute("moves")}},t.prototype.createBoard=function(t){var e=t.children;if(!(e.length<14))for(var n=0;n<14;n++)for(var r=0;r<14;r++){var i=e[n].children[r];if(i instanceof HTMLElement){var o=i.attributes["data-square"];if(o){var a=this.board.square(o.value),u=this.getPieceElement(i.children);if(u){var s=u.attributes["data-piece"];s&&(a.piece=this.createPiece(s.value,o.value))}}}}},t.prototype.createPiece=function(t,e){switch(t.charAt(1)){case"R":return new v(t,e);case"P":return new m(t,e);case"K":return new p(t,e);case"Q":case"D":return new d(t,e);case"B":return new h(t,e);case"N":return new l(t,e);default:return}},t.prototype.analyseSquares=function(t){var e=t.children;if(!(e.length<14))for(var n=0;n<14;n++)for(var r=0;r<14;r++){var i=e[n].children[r];if(i instanceof HTMLElement){var o=i.attributes["data-square"];if(o){var a=this.board.square(o.value);if(a.accessible()){var s=a.piece;s&&(s.player instanceof u||this.checkRadius(t,a))}}}}},t.prototype.checkRadius=function(t,e){this.checkAttackRadius(t,e),this.checkMoveRadius(t,e)},t.prototype.checkAttackRadius=function(t,e){for(var n=e.piece,r=n.attacks(),i=n.radius();!i.done&&i.value<=14&&this.remaining(r)>0;){for(var o=0;o<r.length;o++)this.checkAttackVector(t,e,r[o],i.value);i=n.radius()}},t.prototype.checkMoveRadius=function(t,e){for(var n=e.piece,r=n.moves(),i=n.radius();!i.done&&i.value<=14&&this.remaining(r)>0;){for(var o=0;o<r.length;o++)this.checkMoveVector(t,e,r[o],i.value);i=n.radius()}},t.prototype.checkAttackVector=function(t,e,n,r){if(n[1]){var i=n[0].x1(r),o=n[0].y1(r),a=e.piece.player.rotate(e.n,e.m,i,o),u=a[0],s=a[1];if(!this.board.valid(u,s))return void(n[1]=!1);var c=this.board.squares[s][u];if(!c.accessible())return void(n[1]=!1);this.setAttackCandidate(t,e,c),c.piece&&(n[1]=!1)}},t.prototype.checkMoveVector=function(t,e,n,r){if(n[1]){var i=n[0].x1(r),o=n[0].y1(r),a=e.piece.player.rotate(e.n,e.m,i,o),u=a[0],s=a[1];if(!this.board.valid(u,s))return void(n[1]=!1);var c=this.board.squares[s][u];if(!c.accessible())return void(n[1]=!1);c.piece?n[1]=!1:this.setMoveCandidate(t,e,c)}},t.prototype.setAttackCandidate=function(t,e,n){var r=this.getSquareElement(t,n.code());if(r){var i=r.attributes.attacks;i?i.value=i.value+","+e.code():r.setAttribute("attacks",e.code())}},t.prototype.setMoveCandidate=function(t,e,n){var r=this.getSquareElement(t,n.code());if(r){var i=r.attributes.moves;i?i.value=i.value+","+e.code():r.setAttribute("moves",e.code())}},t.prototype.getSquareElement=function(t,e){var n=t.children;if(!(n.length<14)){var r;t:for(var i=0;i<14;i++)for(var o=0;o<14;o++){var a=n[i].children[o];if(a instanceof HTMLElement&&a.classList.contains("square-"+e)){r=a;break t}}return r}},t.prototype.isTargetSquareValid=function(t,e,n){if(t.children.length<14)return!1;var r=e.attributes["data-square"];if(!r)return!1;var i,o=this.board.square(r.value).piece;if(!o)return!1;if(o.moves().length>0){var a=n.attributes.moves;if(!a)return!1;i=a.value.split(",")}else{var u=n.attributes.attacks;if(!u)return!1;i=u.value.split(",")}return 0!==i.length&&-1!==i.indexOf(r.value)},t.prototype.colouriseSquares=function(t,e,n){var r=t.children;r.length<14||(this.colouriseMovementSquares(r,t,e),this.isTargetSquareValid(t,e,n)&&this.colouriseEnemySquares(r,n))},t.prototype.colouriseMovementSquares=function(t,e,n){var r=n.attributes["data-square"];if(r){var i=this.board.square(r.value).piece;if(i)for(var o=0;o<14;o++)for(var a=0;a<14;a++){var u=t[o].children[a],s=u.attributes["data-square"];if(s&&u instanceof HTMLElement){var c=this.board.square(s.value);if(!c.piece||c.piece.player.name.toLowerCase()!==this.username){var f=void 0;if(0!==i.moves().length){var l=u.attributes.moves;if(!l)continue;f=l.value.split(",")}else{var h=u.attributes.attacks;if(!h)continue;f=h.value.split(",")}if(0!==f.length&&-1!==f.indexOf(r.value)){var d=[],p=u.attributes.attacks;p&&(d=p.value.split(","));var v=d.indexOf(r.value);-1!==v&&d.splice(v,1);var m=this.isFriendlySquare(d),y=this.getColour(u,m);u.style.backgroundColor=y,this.addCodeToModifiedSquares(s.value)}}}}}},t.prototype.colouriseEnemySquares=function(t,e){var n=e.attributes.attacks;if(n){var r=n.value.split(",");if(0!=r.length){var i=e.attributes["data-square"];if(i){var o=r.indexOf(i.value);-1!==o&&r.splice(o,1);for(var a=0;a<r.length;a++)t:for(var u=0;u<14;u++)for(var s=0;s<14;s++){var c=t[u].children[s],f=c.attributes["data-square"];if(f&&c instanceof HTMLElement&&f.value===r[a]){var l=this.board.square(f.value).piece;if(l&&l.player.name.toLowerCase()!==this.username){var h=this.getColour(c,!1);c.style.backgroundColor=h,this.addCodeToModifiedSquares(f.value);break t}}}}}}},t.prototype.colouriseSquaresWithHangingPieces=function(t){var e=t.children;if(!(e.length<14))for(var n=0;n<14;n++)for(var r=0;r<14;r++){var i=e[n].children[r],o=i.attributes["data-square"];if(o&&i instanceof HTMLElement){var a=this.board.square(o.value).piece;if(a&&!(a.player instanceof u)){var s=i.attributes.attacks;if(s){var c=s.value.split(","),f=this.doesSquareHaveHangingPiece(a.player,c);if(f){var l=this.getColour(i,!f);i.style.backgroundColor=l}}}}}},t.prototype.doesSquareHaveHangingPiece=function(t,e){for(var n=0;n<e.length;n++){var r=this.board.square(e[n]).piece;if(r&&r.player.name===t.name)return!1}return!0},t.prototype.isFriendlySquare=function(t){for(var e=0,n=0,r=0;r<t.length;r++){var i=this.board.square(t[r]).piece;i&&(i.player.name.toLowerCase()===this.username?e++:n++)}return 0===e&&0===n||e>n},t.prototype.getColour=function(t,e){var n,r=window.getComputedStyle(t,null).getPropertyValue("background-color");if(0===r.indexOf("#")&&(n=this.hexToRgb(r)),0===r.indexOf("rgb")){var i=r.substring(4,r.length-1).split(", ");n={r:parseInt(i[0]),g:parseInt(i[1]),b:parseInt(i[2])}}return e?"rgb("+n.r+", 255, "+n.b+")":"rgb(255, "+n.g+", "+n.b+")"},t.prototype.addCodeToModifiedSquares=function(t){var e=document.getElementById("four-player-username"),n=e.attributes.modifications;n?n.value=n.value+","+t:e.setAttribute("modifications",t)},t.prototype.show=function(){for(var t=0;t<14;t++){for(var e=["|"],n=0;n<14;n++){var r=this.board.squares[t][n];r.accessible()?e.push(r.piece?r.piece.dp:"[]"):e.push("  ")}e.push("|");var i=this.board.squares;console.log(e.join(" ")+"%O %O %O %O %O %O %O %O %O %O %O %O %O %O |",i[t][0],i[t][1],i[t][2],i[t][3],i[t][4],i[t][5],i[t][6],i[t][7],i[t][8],i[t][9],i[t][10],i[t][11],i[t][12],i[t][13])}},t.prototype.getUsername=function(){for(var t=document.getElementById("four-player-username").innerText,e=document.body.getElementsByClassName("player-avatar"),n=0;n<e.length;n++){var r=e[n];if(r instanceof HTMLAnchorElement&&-1!==r.href.indexOf(t))for(var i=r.parentElement,o=0;o<i.classList.length;o++)for(var a=0;a<this.colours.length;a++)if(this.colours[a]===i.classList[o])return this.colours[a]}},t.prototype.hexToRgb=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,n,r){return e+e+n+n+r+r});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},t.prototype.remaining=function(t){for(var e=0,n=0;n<t.length;n++)t[n][1]&&e++;return e},t.prototype.getPieceElement=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n instanceof HTMLElement&&0===n.className.indexOf("piece-"))return n}},t}(),b=function(){function t(){this.counter=60,this.enabled=!1,this.utterances=[60]}return t.prototype.username=function(){return document.getElementById("four-player-username").innerText},t.prototype.avatar=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n instanceof HTMLElement&&n.classList.contains("player-avatar"))return n}},t.prototype.current=function(t){return parseFloat(t.oldValue.trim().split(":")[1])},t.prototype.reset=function(t){if("childList"===t.type&&t.target instanceof HTMLDivElement&&0===t.target.classList.length&&1===t.addedNodes.length){var e=t.addedNodes[0];if(e instanceof HTMLElement&&e.classList.contains("modal-container"))e.querySelector(".game-over-container")&&(this.utterances=[60],this.counter=60)}},t.prototype.words=function(){return this.counter<=5?this.counter.toString():this.counter+" seconds left"},t.prototype.utterance=function(){return this.rate(new SpeechSynthesisUtterance(this.words()))},t.prototype.rate=function(t){return t.rate=1.8,t},t.prototype.utter=function(t){if(this.enabled&&"characterData"===t.type){var e=t.target.parentNode.parentNode;if(e&&e instanceof HTMLElement&&e.classList.contains("player-clock-timer")){var n=this.avatar(e.children);if(n&&n instanceof HTMLAnchorElement&&n.pathname==="/member/"+this.username()){var r=this.current(t);this.counter-r>0&&this.counter-r<=1&&(this.counter=r),(this.counter<=5&&this.counter%1==0||this.counter>5&&this.counter%5==0)&&this.counter!==this.utterances[0]&&(window.speechSynthesis.speak(this.utterance()),this.utterances.unshift(this.counter))}}}},t}(),w=function(){function t(){this.countdown=new b,this.init={characterDataOldValue:!0,attributeOldValue:!0,characterData:!0,attributes:!0,childList:!0,subtree:!0},this.createDocumentBodyObserverSubscription(),this.observer.observe(document.body,this.init)}return t.prototype.createDocumentBodyObserverSubscription=function(){var t=this;this.observer=new MutationObserver(function(e){e.forEach(function(e){t.countdown.reset(e),t.countdown.utter(e)})})},t}();new(function(){function t(){document.body.addEventListener("mouseover",this.over),document.body.addEventListener("mousedown",this.down),document.body.addEventListener("mouseup",this.up),window.addEventListener("keydown",function(t){(!t.repeat&&"q"===t.key||"Q"===t.key)&&console.log("q key pressed")}),window.addEventListener("keyup",function(t){"q"!==t.key&&"Q"!==t.key||console.log("q key released")}),this.domWatcher=new w,this.rightAlignStartButton(),this.addStartAiButton()}return t.prototype.addStartAiButton=function(){var t=this,e=document.getElementsByClassName("btns-container")[0];if(e instanceof HTMLElement){e.style.cssFloat="right";var n=e.cloneNode(!0);if(n instanceof HTMLElement){n.style.cssFloat="left",n.style.marginRight="12px";var r=n.firstChild;"A"===r.nodeName&&r instanceof HTMLElement&&(r.innerText="Start AI",r.classList.remove("new-game-btn"));var i=n.cloneNode(!0);if(i instanceof HTMLElement){i.style.display="none";var o=i.firstChild;"A"===o.nodeName&&o instanceof HTMLElement&&(o.innerText="Stop AI",o.style.color="#b4b4b3",o.style.borderBottom="#272422",o.style.backgroundColor="#272422",o.addEventListener("click",function(){t.domWatcher.countdown.enabled=!1,i.style.display="none",n.style.display="block"})),r.addEventListener("click",function(){t.domWatcher.countdown.enabled=!0,i.style.display="block",n.style.display="none"})}e.parentNode.appendChild(n),e.parentNode.appendChild(i)}}return this},t.prototype.rightAlignStartButton=function(){var t=document.getElementsByTagName("head")[0];if(t instanceof HTMLElement){var e=document.createTextNode(".btns-container { float: right; }"),n=document.createElement("style");n instanceof HTMLElement&&(n.type="text/css",n.appendChild(e)),t.appendChild(n)}return this},t.prototype.over=function(t){var e=new g;e.showMovesAndEnemies(t.target),e.showHangingPieces(t.target)},t.prototype.down=function(t){var e=new g;e.setOriginSquare(t.target),e.showMovesAndEnemies(t.target)},t.prototype.up=function(t){var e=new g;e.resetOriginSquareAndCleanSquares(),e.showHangingPieces(t.target)},t}())}();
