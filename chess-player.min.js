var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Player=function(){function t(){}return t.create=function(t){switch(t.charAt(0)){case"w":return new Red;case"g":return new Blue;case"b":return new Yellow;case"r":return new Green;case"d":return new Dead;default:return}},t}(),Red=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Red",e.turn=1,e}return __extends(e,t),e.prototype.transform=function(t,e,n,r){return[t+n,e+r]},e}(Player),Blue=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Blue",e.turn=2,e}return __extends(e,t),e.prototype.transform=function(t,e,n,r){return[t+r,e-n]},e}(Player),Yellow=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Yellow",e.turn=3,e}return __extends(e,t),e.prototype.transform=function(t,e,n,r){return[t-n,e-r]},e}(Player),Green=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Green",e.turn=4,e}return __extends(e,t),e.prototype.transform=function(t,e,n,r){return[t-r,e+n]},e}(Player),Dead=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Dead",e.turn=0,e}return __extends(e,t),e.prototype.transform=function(t,e){throw new Error("Not implemented")},e}(Player),Vector=function(){return function(t,e){this.x1=t,this.y1=e}}(),Radius=function(){function t(t){this.counter=0,this.max=t}return t.prototype.next=function(){return!this.max||this.counter<this.max?(this.counter++,{value:this.counter,done:!1}):(this.counter=0,{value:void 0,done:!0})},t.prototype.reset=function(){this.counter=0},t}(),Piece=function(){function t(t,e){this.coords=Square.coords(e),this.player=Player.create(t),this.dp=t}return t.prototype.moved=function(){for(var t=!0,e=0;e<this.home.length;e++){var n=this.home[e][0]-6.5,r=this.home[e][1]-6.5,o=this.player.transform(6.5,6.5,r,n),i=o[0],u=o[1];if(this.coords[1]===i&&this.coords[0]===u){t=!1;break}}return t},t.create=function(t,e){switch(t.charAt(1)){case"R":return new Rook(t,e);case"P":return new Pawn(t,e);case"K":return new King(t,e);case"Q":return new Queen(t,e);case"B":return new Bishop(t,e);case"N":return new Knight(t,e);default:return}},t}(),Rook=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Rook",e.radius=new Radius,e.home=[[0,3],[0,10]],e}return __extends(e,t),e.prototype.attack=function(){return[[new Vector(function(t){return t},function(t){return 0}),!0],[new Vector(function(t){return-t},function(t){return 0}),!0],[new Vector(function(t){return 0},function(t){return t}),!0],[new Vector(function(t){return 0},function(t){return-t}),!0]]},e}(Piece),Pawn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Pawn",e.radius=new Radius(1),e.home=[[1,3],[1,4],[1,5],[1,6],[1,7],[1,8],[1,9],[1,10]],e}return __extends(e,t),e.prototype.attack=function(){return[[new Vector(function(t){return t},function(t){return t}),!0],[new Vector(function(t){return-t},function(t){return t}),!0]]},e}(Piece),King=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="King",e.radius=new Radius(1),e.home=e.player instanceof Red||e.player instanceof Yellow?[[0,7]]:[[0,6]],e}return __extends(e,t),e.prototype.attack=function(){return[[new Vector(function(t){return 1},function(t){return 0}),!0],[new Vector(function(t){return-1},function(t){return 0}),!0],[new Vector(function(t){return 0},function(t){return 1}),!0],[new Vector(function(t){return 0},function(t){return-1}),!0],[new Vector(function(t){return 1},function(t){return 1}),!0],[new Vector(function(t){return 1},function(t){return-1}),!0],[new Vector(function(t){return-1},function(t){return 1}),!0],[new Vector(function(t){return-1},function(t){return-1}),!0]]},e}(Piece),Queen=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Queen",e.radius=new Radius,e.home=e.player instanceof Red||e.player instanceof Yellow?[[0,6]]:[[0,7]],e}return __extends(e,t),e.prototype.attack=function(){return[[new Vector(function(t){return t},function(t){return 0}),!0],[new Vector(function(t){return-t},function(t){return 0}),!0],[new Vector(function(t){return 0},function(t){return t}),!0],[new Vector(function(t){return 0},function(t){return-t}),!0],[new Vector(function(t){return t},function(t){return t}),!0],[new Vector(function(t){return t},function(t){return-t}),!0],[new Vector(function(t){return-t},function(t){return t}),!0],[new Vector(function(t){return-t},function(t){return-t}),!0]]},e}(Piece),Bishop=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Bishop",e.radius=new Radius,e.home=[[0,5],[0,8]],e}return __extends(e,t),e.prototype.attack=function(){return[[new Vector(function(t){return t},function(t){return t}),!0],[new Vector(function(t){return t},function(t){return-t}),!0],[new Vector(function(t){return-t},function(t){return t}),!0],[new Vector(function(t){return-t},function(t){return-t}),!0]]},e}(Piece),Knight=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Knight",e.radius=new Radius(1),e.home=[[0,4],[0,9]],e}return __extends(e,t),e.prototype.attack=function(){return[[new Vector(function(t){return 2},function(t){return 1}),!0],[new Vector(function(t){return 2},function(t){return-1}),!0],[new Vector(function(t){return-2},function(t){return 1}),!0],[new Vector(function(t){return-2},function(t){return-1}),!0],[new Vector(function(t){return 1},function(t){return 2}),!0],[new Vector(function(t){return 1},function(t){return-2}),!0],[new Vector(function(t){return-1},function(t){return 2}),!0],[new Vector(function(t){return-1},function(t){return-2}),!0]]},e}(Piece),Square=function(){function t(t,e){return this.m=t,this.n=e,this}return t.prototype.char=function(t){return String.fromCharCode(t+97)},t.prototype.code=function(){return""+this.char(this.n)+(this.m+1)},t.prototype.accessible=function(){return this.m>=3&&this.m<=10&&this.n>=0&&this.n<=2||this.m>=0&&this.m<=13&&this.n>=3&&this.n<=10||this.m>=3&&this.m<=10&&this.n>=11&&this.n<=13},t.coords=function(t){return[parseInt(t.slice(1))-1,t.charCodeAt(0)-97]},t}(),Board=function(){function t(){this.squares=[];for(var t=0;t<14;t++){this.squares[t]=[];for(var e=0;e<14;e++)this.squares[t][e]=new Square(t,e)}}return t.prototype.square=function(t){var e=Square.coords(t);return this.squares[e[0]][e[1]]},t.prototype.valid=function(t,e){return t>=0&&t<=13&&e>=0&&e<=13},t}(),CountdownHelper=function(){function t(){this.counter=60,this.enabled=!1,this.utterances=[60]}return t.prototype.username=function(){return document.getElementById("four-player-username").innerText},t.prototype.avatar=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n instanceof HTMLElement&&n.classList.contains("player-avatar"))return n}},t.prototype.current=function(t){return parseFloat(t.oldValue.trim().split(":")[1])},t.prototype.reset=function(t){if("childList"===t.type&&t.target instanceof HTMLDivElement&&0===t.target.classList.length&&1===t.addedNodes.length){var e=t.addedNodes[0];if(e instanceof HTMLElement&&e.classList.contains("modal-container"))e.querySelector(".game-over-container")&&(this.utterances=[60],this.counter=60)}},t.prototype.words=function(){return this.counter<=5?this.counter.toString():this.counter+" seconds left"},t.prototype.utterance=function(){return this.rate(new SpeechSynthesisUtterance(this.words()))},t.prototype.rate=function(t){return t.rate=1.8,t},t.prototype.utter=function(t){if(this.enabled&&"characterData"===t.type){var e=t.target.parentNode.parentNode;if(e&&e instanceof HTMLElement&&e.classList.contains("player-clock-timer")){var n=this.avatar(e.childNodes);if(n&&n instanceof HTMLAnchorElement&&n.pathname==="/member/"+this.username()){var r=this.current(t);this.counter-r>0&&this.counter-r<=1&&(this.counter=r),(this.counter<=5&&this.counter%1==0||this.counter>5&&this.counter%5==0)&&this.counter!==this.utterances[0]&&(window.speechSynthesis.speak(this.utterance()),this.utterances.unshift(this.counter))}}}},t}(),AnalysisHelper=function(){function t(){this.colours=["red","blue","yellow","green"],this.turn=0}return t.prototype.process=function(t){"childList"===t.type&&t.target instanceof HTMLElement&&0===t.target.className.indexOf("board-")&&(this.board=new Board,this.name=this.me(),this.create(t),this.analyse(t),this.threats(t))},t.prototype.create=function(t){var e=t.addedNodes;if(e.length>=14)for(var n=0;n<14;n++)for(var r=0;r<14;r++){var o=e[n].childNodes[r];if(o instanceof HTMLElement){var i=o.attributes["data-square"];if(i){var u=this.board.square(i.value),a=this.pieceNode(o.childNodes);if(a){var s=a.attributes["data-piece"];s&&(u.piece=Piece.create(s.value,i.value))}}}}},t.prototype.analyse=function(t){var e=t.addedNodes;if(e.length>=14)for(var n=0;n<14;n++)for(var r=0;r<14;r++){var o=e[n].childNodes[r];if(o instanceof HTMLElement){var i=o.attributes["data-square"];if(i){var u=this.board.square(i.value);if(u.accessible()){var a=u.piece;a&&(a.player instanceof Dead||this.radius(o,u,n,r))}}}}},t.prototype.radius=function(t,e,n,r){for(var o=e.piece,i=o.attack();;){var u=o.radius.next(),a=this.remaining(i);if(u.done||u.value>14||0===a){o.radius.reset();break}for(var s=0;s<i.length;s++)this.vector(t,e,i[s],n,r,u.value)}},t.prototype.vector=function(t,e,n,r,o,i){if(n[1]){var u=n[0].x1(i),a=n[0].y1(i),s=e.piece.player.transform(o,r,u,a),c=s[0],f=s[1];this.board.valid(c,f)&&this.board.squares[f][c].accessible()?(this.candidate(t,e),this.board.squares[f][c].piece&&(n[1]=!1)):n[1]=!1}},t.prototype.candidate=function(t,e){if(this.name===e.piece.player.name.toLowerCase()){var n=t.attributes.friends;n?n.value=n.value+","+e.code():t.setAttribute("friends",e.code())}else{var r=t.attributes.enemies;r?r.value=r.value+","+e.code():t.setAttribute("enemies",e.code())}},t.prototype.friendly=function(t){var e=t.attributes.friends,n=t.attributes.enemies;return!e&&!n||(!(!e||n)||!(n&&!e)&&e.value.split(",").length>n.value.split(",").length)},t.prototype.threats=function(t){var e=t.addedNodes;if(e.length>=14)for(var n=0;n<14;n++)for(var r=0;r<14;r++){var o=e[n].childNodes[r];if(o instanceof HTMLElement){var i=this.colour(o);o.style.backgroundColor=i}}},t.prototype.colour=function(t){var e,n=window.getComputedStyle(t,null).getPropertyValue("background-color");if(0===n.indexOf("#")&&(e=this.hexToRgb(n)),0===n.indexOf("rgb")){var r=n.substring(4,n.length-1).split(", ");e={r:parseInt(r[0]),g:parseInt(r[1]),b:parseInt(r[2])}}return this.friendly(t)?"rgb("+e.r+", 255, "+e.b+")":"rgb(255, "+e.g+", "+e.b+")"},t.prototype.show=function(){for(var t=0;t<14;t++){for(var e=["|"],n=0;n<14;n++){var r=this.board.squares[t][n];r.accessible()?e.push(r.piece?r.piece.dp:"[]"):e.push("  ")}e.push("|");var o=this.board.squares;console.log(e.join(" ")+"%O %O %O %O %O %O %O %O %O %O %O %O %O %O |",o[t][0],o[t][1],o[t][2],o[t][3],o[t][4],o[t][5],o[t][6],o[t][7],o[t][8],o[t][9],o[t][10],o[t][11],o[t][12],o[t][13])}},t.prototype.me=function(){for(var t=document.getElementById("four-player-username").innerText,e=document.body.getElementsByClassName("player-avatar"),n=0;n<e.length;n++){var r=e[n];if(r instanceof HTMLAnchorElement&&-1!==r.href.indexOf(t))for(var o=r.parentElement,i=0;i<o.classList.length;i++)for(var u=0;u<this.colours.length;u++)if(this.colours[u]===o.classList[i])return this.colours[u]}},t.prototype.hexToRgb=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,n,r){return e+e+n+n+r+r});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},t.prototype.remaining=function(t){for(var e=0,n=0;n<t.length;n++)t[n][1]&&e++;return e},t.prototype.pieceNode=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n instanceof HTMLElement&&0===n.className.indexOf("piece-"))return n}},t.prototype.over=function(t){var e;if(console.group("%O",t),t.target instanceof HTMLElement&&(console.log("target"),-1!==t.target.className.indexOf("piece-")&&(e=t.target.parentElement,console.log("piece")),e||(e=t.target,console.log("no piece")),-1!==e.className.indexOf("square-"))){var n=e.attributes["data-square"];console.log("node: %O",e),console.group(n);var r=e.attributes.friends,o=e.attributes.enemies;r&&console.log("friends: "+r.value),o&&console.log("enemies: "+o.value),console.groupEnd()}console.groupEnd()},t}(),DomWatcher=function(){function t(t){this.countdown=new CountdownHelper,this.init={characterDataOldValue:!0,attributeOldValue:!0,characterData:!0,attributes:!0,childList:!0,subtree:!0},this.createDocumentBodyObserverSubscription(),this.observer.observe(document.body,this.init),this.analysis=t}return t.prototype.createDocumentBodyObserverSubscription=function(){var t=this;this.observer=new MutationObserver(function(e){e.forEach(function(e){t.countdown.reset(e),t.countdown.utter(e),t.analysis.process(e)})})},t}(),DomModifier=function(){function t(){var t=new AnalysisHelper;this.domWatcher=new DomWatcher(t),this.watchMouseOvers(t),this.rightAlignStartButton(),this.addStartAiButton()}return t.prototype.addStartAiButton=function(){var t=this,e=document.getElementsByClassName("btns-container")[0];if(e instanceof HTMLElement){e.style.cssFloat="right";var n=e.cloneNode(!0);if(n instanceof HTMLElement){n.style.cssFloat="left",n.style.marginRight="12px";var r=n.firstChild;"A"===r.nodeName&&r instanceof HTMLElement&&(r.innerText="Start AI",r.classList.remove("new-game-btn"));var o=n.cloneNode(!0);if(o instanceof HTMLElement){o.style.display="none";var i=o.firstChild;"A"===i.nodeName&&i instanceof HTMLElement&&(i.innerText="Stop AI",i.style.color="#b4b4b3",i.style.borderBottom="#272422",i.style.backgroundColor="#272422",i.addEventListener("click",function(){t.domWatcher.countdown.enabled=!1,o.style.display="none",n.style.display="block"})),r.addEventListener("click",function(){t.domWatcher.countdown.enabled=!0,o.style.display="block",n.style.display="none"})}e.parentNode.appendChild(n),e.parentNode.appendChild(o)}}return this},t.prototype.rightAlignStartButton=function(){var t=document.getElementsByTagName("head")[0];if(t instanceof HTMLElement){var e=document.createTextNode(".btns-container { float: right; }"),n=document.createElement("style");n instanceof HTMLElement&&(n.type="text/css",n.appendChild(e)),t.appendChild(n)}return this},t.prototype.watchMouseOvers=function(t){return document.addEventListener("mouseover",t.over),this},t}(),modifier=new DomModifier;